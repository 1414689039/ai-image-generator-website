(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,61080,e=>{"use strict";var t=e.i(843476),s=e.i(271645),a=e.i(452453),i=e.i(10708),r=e.i(167881),l=e.i(248425),n=e.i(296626),o=e.i(30030),d=e.i(820783),c=e.i(30207),u=e.i(586318),m=e.i(934620),h=e.i(470152),p=e.i(981140),x="ScrollArea",[f,g]=(0,o.createContextScope)(x),[v,b]=f(x),w=s.forwardRef((e,a)=>{let{__scopeScrollArea:i,type:r="hover",dir:n,scrollHideDelay:o=600,...c}=e,[m,h]=s.useState(null),[p,x]=s.useState(null),[f,g]=s.useState(null),[b,w]=s.useState(null),[j,y]=s.useState(null),[N,k]=s.useState(0),[C,_]=s.useState(0),[S,P]=s.useState(!1),[T,L]=s.useState(!1),R=(0,d.useComposedRefs)(a,e=>h(e)),M=(0,u.useDirection)(n);return(0,t.jsx)(v,{scope:i,type:r,dir:M,scrollHideDelay:o,scrollArea:m,viewport:p,onViewportChange:x,content:f,onContentChange:g,scrollbarX:b,onScrollbarXChange:w,scrollbarXEnabled:S,onScrollbarXEnabledChange:P,scrollbarY:j,onScrollbarYChange:y,scrollbarYEnabled:T,onScrollbarYEnabledChange:L,onCornerWidthChange:k,onCornerHeightChange:_,children:(0,t.jsx)(l.Primitive.div,{dir:M,...c,ref:R,style:{position:"relative","--radix-scroll-area-corner-width":N+"px","--radix-scroll-area-corner-height":C+"px",...e.style}})})});w.displayName=x;var j="ScrollAreaViewport",y=s.forwardRef((e,a)=>{let{__scopeScrollArea:i,children:r,nonce:n,...o}=e,c=b(j,i),u=s.useRef(null),m=(0,d.useComposedRefs)(a,u,c.onViewportChange);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),(0,t.jsx)(l.Primitive.div,{"data-radix-scroll-area-viewport":"",...o,ref:m,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...e.style},children:(0,t.jsx)("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:r})})]})});y.displayName=j;var N="ScrollAreaScrollbar",k=s.forwardRef((e,a)=>{let{forceMount:i,...r}=e,l=b(N,e.__scopeScrollArea),{onScrollbarXEnabledChange:n,onScrollbarYEnabledChange:o}=l,d="horizontal"===e.orientation;return s.useEffect(()=>(d?n(!0):o(!0),()=>{d?n(!1):o(!1)}),[d,n,o]),"hover"===l.type?(0,t.jsx)(C,{...r,ref:a,forceMount:i}):"scroll"===l.type?(0,t.jsx)(_,{...r,ref:a,forceMount:i}):"auto"===l.type?(0,t.jsx)(S,{...r,ref:a,forceMount:i}):"always"===l.type?(0,t.jsx)(P,{...r,ref:a}):null});k.displayName=N;var C=s.forwardRef((e,a)=>{let{forceMount:i,...r}=e,l=b(N,e.__scopeScrollArea),[o,d]=s.useState(!1);return s.useEffect(()=>{let e=l.scrollArea,t=0;if(e){let s=()=>{window.clearTimeout(t),d(!0)},a=()=>{t=window.setTimeout(()=>d(!1),l.scrollHideDelay)};return e.addEventListener("pointerenter",s),e.addEventListener("pointerleave",a),()=>{window.clearTimeout(t),e.removeEventListener("pointerenter",s),e.removeEventListener("pointerleave",a)}}},[l.scrollArea,l.scrollHideDelay]),(0,t.jsx)(n.Presence,{present:i||o,children:(0,t.jsx)(S,{"data-state":o?"visible":"hidden",...r,ref:a})})}),_=s.forwardRef((e,a)=>{var i;let{forceMount:r,...l}=e,o=b(N,e.__scopeScrollArea),d="horizontal"===e.orientation,c=K(()=>m("SCROLL_END"),100),[u,m]=(i={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},s.useReducer((e,t)=>i[e][t]??e,"hidden"));return s.useEffect(()=>{if("idle"===u){let e=window.setTimeout(()=>m("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(e)}},[u,o.scrollHideDelay,m]),s.useEffect(()=>{let e=o.viewport,t=d?"scrollLeft":"scrollTop";if(e){let s=e[t],a=()=>{let a=e[t];s!==a&&(m("SCROLL"),c()),s=a};return e.addEventListener("scroll",a),()=>e.removeEventListener("scroll",a)}},[o.viewport,d,m,c]),(0,t.jsx)(n.Presence,{present:r||"hidden"!==u,children:(0,t.jsx)(P,{"data-state":"hidden"===u?"hidden":"visible",...l,ref:a,onPointerEnter:(0,p.composeEventHandlers)(e.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:(0,p.composeEventHandlers)(e.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),S=s.forwardRef((e,a)=>{let i=b(N,e.__scopeScrollArea),{forceMount:r,...l}=e,[o,d]=s.useState(!1),c="horizontal"===e.orientation,u=K(()=>{if(i.viewport){let e=i.viewport.offsetWidth<i.viewport.scrollWidth,t=i.viewport.offsetHeight<i.viewport.scrollHeight;d(c?e:t)}},10);return V(i.viewport,u),V(i.content,u),(0,t.jsx)(n.Presence,{present:r||o,children:(0,t.jsx)(P,{"data-state":o?"visible":"hidden",...l,ref:a})})}),P=s.forwardRef((e,a)=>{let{orientation:i="vertical",...r}=e,l=b(N,e.__scopeScrollArea),n=s.useRef(null),o=s.useRef(0),[d,c]=s.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=F(d.viewport,d.content),m={...r,sizes:d,onSizesChange:c,hasThumb:!!(u>0&&u<1),onThumbChange:e=>n.current=e,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:e=>o.current=e};function h(e,t){return function(e,t,s,a="ltr"){let i=O(s),r=t||i/2,l=s.scrollbar.paddingStart+r,n=s.scrollbar.size-s.scrollbar.paddingEnd-(i-r),o=s.content-s.viewport;return B([l,n],"ltr"===a?[0,o]:[-1*o,0])(e)}(e,o.current,d,t)}return"horizontal"===i?(0,t.jsx)(T,{...m,ref:a,onThumbPositionChange:()=>{if(l.viewport&&n.current){let e=q(l.viewport.scrollLeft,d,l.dir);n.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{l.viewport&&(l.viewport.scrollLeft=e)},onDragScroll:e=>{l.viewport&&(l.viewport.scrollLeft=h(e,l.dir))}}):"vertical"===i?(0,t.jsx)(L,{...m,ref:a,onThumbPositionChange:()=>{if(l.viewport&&n.current){let e=q(l.viewport.scrollTop,d);n.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{l.viewport&&(l.viewport.scrollTop=e)},onDragScroll:e=>{l.viewport&&(l.viewport.scrollTop=h(e))}}):null}),T=s.forwardRef((e,a)=>{let{sizes:i,onSizesChange:r,...l}=e,n=b(N,e.__scopeScrollArea),[o,c]=s.useState(),u=s.useRef(null),m=(0,d.useComposedRefs)(a,u,n.onScrollbarXChange);return s.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),(0,t.jsx)(E,{"data-orientation":"horizontal",...l,ref:m,sizes:i,style:{bottom:0,left:"rtl"===n.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===n.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":O(i)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.x),onDragScroll:t=>e.onDragScroll(t.x),onWheelScroll:(t,s)=>{if(n.viewport){var a,i;let r=n.viewport.scrollLeft+t.deltaX;e.onWheelScroll(r),a=r,i=s,a>0&&a<i&&t.preventDefault()}},onResize:()=>{u.current&&n.viewport&&o&&r({content:n.viewport.scrollWidth,viewport:n.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:W(o.paddingLeft),paddingEnd:W(o.paddingRight)}})}})}),L=s.forwardRef((e,a)=>{let{sizes:i,onSizesChange:r,...l}=e,n=b(N,e.__scopeScrollArea),[o,c]=s.useState(),u=s.useRef(null),m=(0,d.useComposedRefs)(a,u,n.onScrollbarYChange);return s.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),(0,t.jsx)(E,{"data-orientation":"vertical",...l,ref:m,sizes:i,style:{top:0,right:"ltr"===n.dir?0:void 0,left:"rtl"===n.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":O(i)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.y),onDragScroll:t=>e.onDragScroll(t.y),onWheelScroll:(t,s)=>{if(n.viewport){var a,i;let r=n.viewport.scrollTop+t.deltaY;e.onWheelScroll(r),a=r,i=s,a>0&&a<i&&t.preventDefault()}},onResize:()=>{u.current&&n.viewport&&o&&r({content:n.viewport.scrollHeight,viewport:n.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:W(o.paddingTop),paddingEnd:W(o.paddingBottom)}})}})}),[R,M]=f(N),E=s.forwardRef((e,a)=>{let{__scopeScrollArea:i,sizes:r,hasThumb:n,onThumbChange:o,onThumbPointerUp:u,onThumbPointerDown:m,onThumbPositionChange:h,onDragScroll:x,onWheelScroll:f,onResize:g,...v}=e,w=b(N,i),[j,y]=s.useState(null),k=(0,d.useComposedRefs)(a,e=>y(e)),C=s.useRef(null),_=s.useRef(""),S=w.viewport,P=r.content-r.viewport,T=(0,c.useCallbackRef)(f),L=(0,c.useCallbackRef)(h),M=K(g,10);function E(e){C.current&&x({x:e.clientX-C.current.left,y:e.clientY-C.current.top})}return s.useEffect(()=>{let e=e=>{let t=e.target;j?.contains(t)&&T(e,P)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[S,j,P,T]),s.useEffect(L,[r,L]),V(j,M),V(w.content,M),(0,t.jsx)(R,{scope:i,scrollbar:j,hasThumb:n,onThumbChange:(0,c.useCallbackRef)(o),onThumbPointerUp:(0,c.useCallbackRef)(u),onThumbPositionChange:L,onThumbPointerDown:(0,c.useCallbackRef)(m),children:(0,t.jsx)(l.Primitive.div,{...v,ref:k,style:{position:"absolute",...v.style},onPointerDown:(0,p.composeEventHandlers)(e.onPointerDown,e=>{0===e.button&&(e.target.setPointerCapture(e.pointerId),C.current=j.getBoundingClientRect(),_.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",w.viewport&&(w.viewport.style.scrollBehavior="auto"),E(e))}),onPointerMove:(0,p.composeEventHandlers)(e.onPointerMove,E),onPointerUp:(0,p.composeEventHandlers)(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=_.current,w.viewport&&(w.viewport.style.scrollBehavior=""),C.current=null})})})}),D="ScrollAreaThumb",z=s.forwardRef((e,s)=>{let{forceMount:a,...i}=e,r=M(D,e.__scopeScrollArea);return(0,t.jsx)(n.Presence,{present:a||r.hasThumb,children:(0,t.jsx)($,{ref:s,...i})})}),$=s.forwardRef((e,a)=>{let{__scopeScrollArea:i,style:r,...n}=e,o=b(D,i),c=M(D,i),{onThumbPositionChange:u}=c,m=(0,d.useComposedRefs)(a,e=>c.onThumbChange(e)),h=s.useRef(void 0),x=K(()=>{h.current&&(h.current(),h.current=void 0)},100);return s.useEffect(()=>{let e=o.viewport;if(e){let t=()=>{x(),h.current||(h.current=H(e,u),u())};return u(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}},[o.viewport,x,u]),(0,t.jsx)(l.Primitive.div,{"data-state":c.hasThumb?"visible":"hidden",...n,ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...r},onPointerDownCapture:(0,p.composeEventHandlers)(e.onPointerDownCapture,e=>{let t=e.target.getBoundingClientRect(),s=e.clientX-t.left,a=e.clientY-t.top;c.onThumbPointerDown({x:s,y:a})}),onPointerUp:(0,p.composeEventHandlers)(e.onPointerUp,c.onThumbPointerUp)})});z.displayName=D;var I="ScrollAreaCorner",U=s.forwardRef((e,s)=>{let a=b(I,e.__scopeScrollArea),i=!!(a.scrollbarX&&a.scrollbarY);return"scroll"!==a.type&&i?(0,t.jsx)(A,{...e,ref:s}):null});U.displayName=I;var A=s.forwardRef((e,a)=>{let{__scopeScrollArea:i,...r}=e,n=b(I,i),[o,d]=s.useState(0),[c,u]=s.useState(0),m=!!(o&&c);return V(n.scrollbarX,()=>{let e=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(e),u(e)}),V(n.scrollbarY,()=>{let e=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(e),d(e)}),m?(0,t.jsx)(l.Primitive.div,{...r,ref:a,style:{width:o,height:c,position:"absolute",right:"ltr"===n.dir?0:void 0,left:"rtl"===n.dir?0:void 0,bottom:0,...e.style}}):null});function W(e){return e?parseInt(e,10):0}function F(e,t){let s=e/t;return isNaN(s)?0:s}function O(e){let t=F(e.viewport,e.content),s=e.scrollbar.paddingStart+e.scrollbar.paddingEnd;return Math.max((e.scrollbar.size-s)*t,18)}function q(e,t,s="ltr"){let a=O(t),i=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,r=t.scrollbar.size-i,l=t.content-t.viewport,n=(0,h.clamp)(e,"ltr"===s?[0,l]:[-1*l,0]);return B([0,l],[0,r-a])(n)}function B(e,t){return s=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let a=(t[1]-t[0])/(e[1]-e[0]);return t[0]+a*(s-e[0])}}var H=(e,t=()=>{})=>{let s={left:e.scrollLeft,top:e.scrollTop},a=0;return!function i(){let r={left:e.scrollLeft,top:e.scrollTop},l=s.left!==r.left,n=s.top!==r.top;(l||n)&&t(),s=r,a=window.requestAnimationFrame(i)}(),()=>window.cancelAnimationFrame(a)};function K(e,t){let a=(0,c.useCallbackRef)(e),i=s.useRef(0);return s.useEffect(()=>()=>window.clearTimeout(i.current),[]),s.useCallback(()=>{window.clearTimeout(i.current),i.current=window.setTimeout(a,t)},[a,t])}function V(e,t){let s=(0,c.useCallbackRef)(t);(0,m.useLayoutEffect)(()=>{let t=0;if(e){let a=new ResizeObserver(()=>{cancelAnimationFrame(t),t=window.requestAnimationFrame(s)});return a.observe(e),()=>{window.cancelAnimationFrame(t),a.unobserve(e)}}},[e,s])}var G=e.i(647163);function X({className:e,children:s,...a}){return(0,t.jsxs)(w,{"data-slot":"scroll-area",className:(0,G.cn)("relative",e),...a,children:[(0,t.jsx)(y,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:s}),(0,t.jsx)(J,{}),(0,t.jsx)(U,{})]})}function J({className:e,orientation:s="vertical",...a}){return(0,t.jsx)(k,{"data-slot":"scroll-area-scrollbar",orientation:s,className:(0,G.cn)("flex touch-none p-px transition-colors select-none","vertical"===s&&"h-full w-2.5 border-l border-l-transparent","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent",e),...a,children:(0,t.jsx)(z,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var Y=e.i(475254);let Q=(0,Y.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var Z=e.i(278716),ee=e.i(37727),et=e.i(531278),es={outline:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},filled:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none"}};let ea=(e,t,a,i)=>{let r=(0,s.forwardRef)(({color:a="currentColor",size:r=24,stroke:l=2,title:n,className:o,children:d,...c},u)=>(0,s.createElement)("svg",{ref:u,...es[e],width:r,height:r,className:["tabler-icon",`tabler-icon-${t}`,o].join(" "),..."filled"===e?{fill:a}:{strokeWidth:l,stroke:a},...c},[n&&(0,s.createElement)("title",{key:"svg-title"},n),...i.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(d)?d:[d]]));return r.displayName=`${a}`,r},ei=ea("outline","layout-navbar-collapse","LayoutNavbarCollapse",[["path",{d:"M4 18v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M4 9h16",key:"svg-1"}],["path",{d:"M10 16l2 -2l2 2",key:"svg-2"}]]);e.i(247167);var er=e.i(231178),el=e.i(947414),en=e.i(674008),eo=e.i(821476),ed=e.i(772846),ec=s,eu=e.i(737806);function em(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class eh extends ec.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,s=(0,ed.isHTMLElement)(e)&&e.offsetWidth||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=s-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ep({children:e,isPresent:a,anchorX:i,root:r}){let l=(0,ec.useId)(),n=(0,ec.useRef)(null),o=(0,ec.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:d}=(0,ec.useContext)(eu.MotionConfigContext),c=function(...e){return s.useCallback(function(...e){return t=>{let s=!1,a=e.map(e=>{let a=em(e,t);return s||"function"!=typeof a||(s=!0),a});if(s)return()=>{for(let t=0;t<a.length;t++){let s=a[t];"function"==typeof s?s():em(e[t],null)}}}}(...e),e)}(n,e?.ref);return(0,ec.useInsertionEffect)(()=>{let{width:e,height:t,top:s,left:c,right:u}=o.current;if(a||!n.current||!e||!t)return;let m="left"===i?`left: ${c}`:`right: ${u}`;n.current.dataset.motionPopId=l;let h=document.createElement("style");d&&(h.nonce=d);let p=r??document.head;return p.appendChild(h),h.sheet&&h.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${t}px !important;
            ${m}px !important;
            top: ${s}px !important;
          }
        `),()=>{p.contains(h)&&p.removeChild(h)}},[a]),(0,t.jsx)(eh,{isPresent:a,childRef:n,sizeRef:o,children:ec.cloneElement(e,{ref:c})})}let ex=({children:e,initial:a,isPresent:i,onExitComplete:r,custom:l,presenceAffectsLayout:n,mode:o,anchorX:d,root:c})=>{let u=(0,el.useConstant)(ef),m=(0,s.useId)(),h=!0,p=(0,s.useMemo)(()=>(h=!1,{id:m,initial:a,isPresent:i,custom:l,onExitComplete:e=>{for(let t of(u.set(e,!0),u.values()))if(!t)return;r&&r()},register:e=>(u.set(e,!1),()=>u.delete(e))}),[i,u,r]);return n&&h&&(p={...p}),(0,s.useMemo)(()=>{u.forEach((e,t)=>u.set(t,!1))},[i]),s.useEffect(()=>{i||u.size||!r||r()},[i]),"popLayout"===o&&(e=(0,t.jsx)(ep,{isPresent:i,anchorX:d,root:c,children:e})),(0,t.jsx)(eo.PresenceContext.Provider,{value:p,children:e})};function ef(){return new Map}var eg=e.i(464978);let ev=e=>e.key||"";function eb(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}let ew=({children:e,custom:a,initial:i=!0,onExitComplete:r,presenceAffectsLayout:l=!0,mode:n="sync",propagate:o=!1,anchorX:d="left",root:c})=>{let[u,m]=(0,eg.usePresence)(o),h=(0,s.useMemo)(()=>eb(e),[e]),p=o&&!u?[]:h.map(ev),x=(0,s.useRef)(!0),f=(0,s.useRef)(h),g=(0,el.useConstant)(()=>new Map),[v,b]=(0,s.useState)(h),[w,j]=(0,s.useState)(h);(0,en.useIsomorphicLayoutEffect)(()=>{x.current=!1,f.current=h;for(let e=0;e<w.length;e++){let t=ev(w[e]);p.includes(t)?g.delete(t):!0!==g.get(t)&&g.set(t,!1)}},[w,p.length,p.join("-")]);let y=[];if(h!==v){let e=[...h];for(let t=0;t<w.length;t++){let s=w[t],a=ev(s);p.includes(a)||(e.splice(t,0,s),y.push(s))}return"wait"===n&&y.length&&(e=y),j(eb(e)),b(h),null}let{forceRender:N}=(0,s.useContext)(er.LayoutGroupContext);return(0,t.jsx)(t.Fragment,{children:w.map(e=>{let s=ev(e),v=(!o||!!u)&&(h===w||p.includes(s));return(0,t.jsx)(ex,{isPresent:v,initial:(!x.current||!!i)&&void 0,custom:a,presenceAffectsLayout:l,mode:n,root:c,onExitComplete:v?void 0:()=>{if(!g.has(s))return;g.set(s,!0);let e=!0;g.forEach(t=>{t||(e=!1)}),e&&(N?.(),j(f.current),o&&m?.(),r&&r())},anchorX:d,children:e},s)})})};var ej=e.i(846932),ey=e.i(887652),eN=e.i(486427),ek=e.i(83352),eC=e.i(83411),e_=e.i(287022);function eS(e){return"number"==typeof e?e:parseFloat(e)}var eP=e.i(344230),eT=e.i(212381);function eL(e,t,s,a){if("function"==typeof e){let t;return eN.collectMotionValues.current=[],e(),t=(0,eT.useCombineMotionValues)(eN.collectMotionValues.current,e),eN.collectMotionValues.current=void 0,t}let i="function"==typeof t?t:function(...e){let t=!Array.isArray(e[0]),s=t?0:-1,a=e[0+s],i=e[1+s],r=e[2+s],l=e[3+s],n=(0,eP.interpolate)(i,r,l);return t?n(a):n}(t,s,a);return Array.isArray(e)?eR(e,i):eR([e],([e])=>i(e))}function eR(e,t){let s=(0,el.useConstant)(()=>[]);return(0,eT.useCombineMotionValues)(e,()=>{s.length=0;let a=e.length;for(let t=0;t<a;t++)s[t]=e[t].get();return t(s)})}function eM(e,t={}){let{isStatic:a}=(0,s.useContext)(eu.MotionConfigContext),i=()=>(0,eC.isMotionValue)(e)?e.get():e;if(a)return eL(i);let r=(0,ey.useMotionValue)(i());return(0,s.useInsertionEffect)(()=>(function(e,t,s){let a,i=e.get(),r=null,l=i,n="string"==typeof i?i.replace(/[\d.-]/g,""):void 0,o=()=>{r&&(r.stop(),r=null)},d=()=>{o(),r=new ek.JSAnimation({keyframes:[eS(e.get()),eS(l)],velocity:e.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...s,onUpdate:a})};if(e.attach((e,t)=>{l=e,a=e=>{var s,a;return t((s=e,(a=n)?s+a:s))},e_.frame.postRender(d)},o),(0,eC.isMotionValue)(t)){let s=t.on("change",t=>{var s,a;return e.set((s=t,(a=n)?s+a:s))}),a=e.on("destroy",s);return()=>{s(),a()}}return o})(r,e,t),[r,JSON.stringify(t)]),r}let eE=({items:e,desktopClassName:s,mobileClassName:a})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ez,{items:e,className:s}),(0,t.jsx)(eD,{items:e,className:a})]}),eD=({items:e,className:a})=>{let[i,r]=(0,s.useState)(!1);return(0,t.jsxs)("div",{className:(0,G.cn)("relative block md:hidden",a),children:[(0,t.jsx)(ew,{children:i&&(0,t.jsx)(ej.motion.div,{layoutId:"nav",className:"absolute inset-x-0 bottom-full mb-2 flex flex-col gap-2",children:e.map((s,a)=>(0,t.jsx)(ej.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10,transition:{delay:.05*a}},transition:{delay:(e.length-1-a)*.05},children:(0,t.jsx)("a",{href:s.href,onClick:e=>{s.onClick&&(e.preventDefault(),s.onClick())},className:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-50 dark:bg-neutral-900",children:(0,t.jsx)("div",{className:"h-4 w-4",children:s.icon})},s.title)},s.title))})}),(0,t.jsx)("button",{onClick:()=>r(!i),className:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-50 dark:bg-neutral-800",children:(0,t.jsx)(ei,{className:"h-5 w-5 text-neutral-500 dark:text-neutral-400"})})]})},ez=({items:e,className:s})=>{let a=(0,ey.useMotionValue)(1/0);return(0,t.jsx)(ej.motion.div,{onMouseMove:e=>a.set(e.pageX),onMouseLeave:()=>a.set(1/0),className:(0,G.cn)("mx-auto hidden h-20 items-end gap-4 rounded-2xl bg-gray-50 px-4 pb-2 md:flex dark:bg-neutral-900",s),children:e.map(e=>(0,t.jsx)(e$,{mouseX:a,...e},e.title))})};function e$({mouseX:e,title:a,icon:i,href:r,onClick:l}){let n=(0,s.useRef)(null),o=eL(e,e=>{let t=n.current?.getBoundingClientRect()??{x:0,width:0};return e-t.x-t.width/2}),d=eL(o,[-150,0,150],[40,80,40]),c=eL(o,[-150,0,150],[40,80,40]),u=eL(o,[-150,0,150],[20,40,20]),m=eL(o,[-150,0,150],[20,40,20]),h=eM(eL(o,[-150,0,150],[10,16,10]),{mass:.1,stiffness:150,damping:12}),p=eL(h,e=>`${e}px`),x=eM(d,{mass:.1,stiffness:150,damping:12}),f=eM(c,{mass:.1,stiffness:150,damping:12}),g=eM(u,{mass:.1,stiffness:150,damping:12}),v=eM(m,{mass:.1,stiffness:150,damping:12}),[b,w]=(0,s.useState)(!1);return(0,t.jsxs)("a",{href:r,className:"flex flex-col items-center justify-end",onClick:e=>{l&&(e.preventDefault(),l())},children:[(0,t.jsx)(ej.motion.div,{ref:n,style:{width:x,height:f},onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),className:"relative flex aspect-square items-center justify-center rounded-full bg-gray-200 dark:bg-neutral-800 flex-shrink-0",children:(0,t.jsx)(ej.motion.div,{style:{width:g,height:v},className:"flex items-center justify-center",children:i})}),(0,t.jsx)(ej.motion.div,{style:{fontSize:p},className:"mt-1 text-center font-medium text-neutral-500 dark:text-neutral-400 whitespace-nowrap",children:a})]})}let eI=ea("outline","history","History",[["path",{d:"M12 8l0 4l2 2",key:"svg-0"}],["path",{d:"M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5",key:"svg-1"}]]),eU=ea("outline","receipt","Receipt",[["path",{d:"M5 21v-16a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v16l-3 -2l-2 2l-2 -2l-2 2l-2 -2l-3 2m4 -14h6m-6 4h6m-2 4h2",key:"svg-0"}]]),eA=ea("outline","exchange","Exchange",[["path",{d:"M5 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-0"}],["path",{d:"M19 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M19 8v5a5 5 0 0 1 -5 5h-3l3 -3m0 6l-3 -3",key:"svg-2"}],["path",{d:"M5 16v-5a5 5 0 0 1 5 -5h3l-3 -3m0 6l3 -3",key:"svg-3"}]]);var eW=e.i(920755),eF=e.i(95187),eO=(0,eF.createServerReference)("400f943ea7520b40eedc64af24e4b7cd1789733105",eF.callServer,void 0,eF.findSourceMapURL,"softDeleteTask"),eq=e.i(630374),eB=e.i(842727),eH=e.i(369340),eK=e.i(610772),eV="Tabs",[eG,eX]=(0,o.createContextScope)(eV,[eB.createRovingFocusGroupScope]),eJ=(0,eB.createRovingFocusGroupScope)(),[eY,eQ]=eG(eV),eZ=s.forwardRef((e,s)=>{let{__scopeTabs:a,value:i,onValueChange:r,defaultValue:n,orientation:o="horizontal",dir:d,activationMode:c="automatic",...m}=e,h=(0,u.useDirection)(d),[p,x]=(0,eH.useControllableState)({prop:i,onChange:r,defaultProp:n??"",caller:eV});return(0,t.jsx)(eY,{scope:a,baseId:(0,eK.useId)(),value:p,onValueChange:x,orientation:o,dir:h,activationMode:c,children:(0,t.jsx)(l.Primitive.div,{dir:h,"data-orientation":o,...m,ref:s})})});eZ.displayName=eV;var e0="TabsList",e1=s.forwardRef((e,s)=>{let{__scopeTabs:a,loop:i=!0,...r}=e,n=eQ(e0,a),o=eJ(a);return(0,t.jsx)(eB.Root,{asChild:!0,...o,orientation:n.orientation,dir:n.dir,loop:i,children:(0,t.jsx)(l.Primitive.div,{role:"tablist","aria-orientation":n.orientation,...r,ref:s})})});e1.displayName=e0;var e2="TabsTrigger",e3=s.forwardRef((e,s)=>{let{__scopeTabs:a,value:i,disabled:r=!1,...n}=e,o=eQ(e2,a),d=eJ(a),c=e8(o.baseId,i),u=e6(o.baseId,i),m=i===o.value;return(0,t.jsx)(eB.Item,{asChild:!0,...d,focusable:!r,active:m,children:(0,t.jsx)(l.Primitive.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":u,"data-state":m?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:c,...n,ref:s,onMouseDown:(0,p.composeEventHandlers)(e.onMouseDown,e=>{r||0!==e.button||!1!==e.ctrlKey?e.preventDefault():o.onValueChange(i)}),onKeyDown:(0,p.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&o.onValueChange(i)}),onFocus:(0,p.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==o.activationMode;m||r||!e||o.onValueChange(i)})})})});e3.displayName=e2;var e4="TabsContent",e5=s.forwardRef((e,a)=>{let{__scopeTabs:i,value:r,forceMount:o,children:d,...c}=e,u=eQ(e4,i),m=e8(u.baseId,r),h=e6(u.baseId,r),p=r===u.value,x=s.useRef(p);return s.useEffect(()=>{let e=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,t.jsx)(n.Presence,{present:o||p,children:({present:s})=>(0,t.jsx)(l.Primitive.div,{"data-state":p?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":m,hidden:!s,id:h,tabIndex:0,...c,ref:a,style:{...e.style,animationDuration:x.current?"0s":void 0},children:s&&d})})});function e8(e,t){return`${e}-trigger-${t}`}function e6(e,t){return`${e}-content-${t}`}e5.displayName=e4;let e7=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)(e1,{ref:a,className:(0,G.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...s}));e7.displayName=e1.displayName;let e9=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)(e3,{ref:a,className:(0,G.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...s}));e9.displayName=e3.displayName,s.forwardRef(({className:e,...s},a)=>(0,t.jsx)(e5,{ref:a,className:(0,G.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s})).displayName=e5.displayName;var te=e.i(625959);let tt=(0,Y.default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var ts=e.i(283086);let ta=(0,Y.default)("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);var ti=e.i(727612);let tr=(0,Y.default)("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),tl=(0,Y.default)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),tn=(0,Y.default)("square-check-big",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var to=e.i(120682);function td(e){if(!e)return"";let t="xiguapi.fan";{let e=window.location.hostname;e.includes("w8nrind.ai")?t="image-upload.xiguapi.tech":e.includes("w8nrind.com")&&(t="generation.w8nrind.com")}if(e.startsWith("http://")||e.startsWith("https://")){try{let s=new URL(e);if(["image-upload.xiguapi.tech","xiguapi.fan","r2.xiguapi.tech","generation.w8nrind.com"].some(e=>s.hostname===e)&&s.hostname!==t)return s.hostname=t,s.toString()}catch(t){console.warn("Invalid URL in formatImageUrl:",e)}return e}let s=e.startsWith("/")?e.slice(1):e;return`https://${t}/${s}`}function tc({open:e,onOpenChange:a,onApplyTask:l}){let n,o,[d,c]=(0,s.useState)([]),[u,m]=(0,s.useState)(null),[h,p]=(0,s.useState)(!0),[x,f]=(0,s.useState)("all"),[g,v]=(0,s.useState)(!1),{toast:b}=(0,to.useToast)(),[w,j]=(0,s.useState)(!1),[y,N]=(0,s.useState)(new Set),[k,C]=(0,s.useState)(!1),[_,S]=(0,s.useState)(0);(0,s.useEffect)(()=>{S(0)},[u?.id]),(0,s.useEffect)(()=>{e&&(async()=>{let e=(0,eW.createClient)(),{data:{user:t}}=await e.auth.getUser();if(!t)return;let s=new Date(Date.now()-1728e5).toISOString(),a=new Date(Date.now()-2592e6).toISOString(),{data:i}=await e.from("tasks_view").select("*").eq("user_id",t.id).or(`created_at.gte.${s},and(status.eq.saved,created_at.gte.${a})`).order("created_at",{ascending:!1});if(i){new Date(a).getTime();let e=i.filter(e=>!e.result?.images?.includes("delete"));c(e),e.length>0&&m(e[0])}})()},[e]);let P=async e=>{try{await eO(e),c(t=>t.filter(t=>t.id!==e)),u?.id===e&&m(null)}catch(e){console.error("Failed to delete task",e)}},T=async e=>{if(("success"===e.status||"saved"===e.status)&&"saved"!==e.status){v(!0);try{let t=await fetch("/api/tasks/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:e.id})});if(t.ok)c(t=>t.map(t=>t.id===e.id?{...t,status:"saved"}:t)),u?.id===e.id&&m(e=>({...e,status:"saved"}));else{let e=await t.json();console.error("Failed to save task:",e.error)}}catch(e){console.error(e)}finally{v(!1)}}},L=()=>{j(!w),N(new Set)},R=async()=>{if(0!==y.size){C(!0);try{let e=Array.from(y);await Promise.all(e.map(e=>eO(e))),c(e=>e.filter(e=>!y.has(e.id))),u&&y.has(u.id)&&m(null),j(!1),N(new Set)}catch(e){console.error("Batch delete failed",e)}finally{C(!1)}}},M=(n=d,(h&&(n=n.filter(e=>"success"===e.status||"saved"===e.status)),"saved"===x)?n.filter(e=>"saved"===e.status):"video"===x?n.filter(e=>"video_generation"===e.type):"image"===x?n.filter(e=>"image_generation"===e.type):n),E=e=>{f(e);let t=[];(t=d.filter(t=>(!h||"success"===t.status||"saved"===t.status)&&("all"===e||("video"===e?"video_generation"===t.type:"image"===e?"image_generation"===t.type:"saved"!==e||"saved"===t.status)))).length>0?m(t[0]):m(null)};return(0,t.jsx)(eq.Dialog,{open:e,onOpenChange:a,children:(0,t.jsxs)(eq.DialogContent,{showCloseButton:!1,className:"max-w-[90vw] h-[85vh] p-0 gap-0 overflow-visible border-none shadow-none bg-transparent",children:[(0,t.jsxs)("div",{className:"flex flex-row w-full h-full overflow-hidden rounded-lg border bg-background shadow-lg",children:[(0,t.jsx)("div",{className:"w-[60%] flex flex-col border-r bg-muted/5 h-full",children:u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex-1 min-h-0 relative flex flex-col bg-black/5",children:[(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center p-4 min-h-0",children:u.result?.images?.[_]?(o=td(u.result.images[_])).toLowerCase().endsWith(".mp4")||"video_generation"===u.type?(0,t.jsx)("video",{src:o,controls:!0,className:"max-w-full max-h-full object-contain rounded-lg shadow-md"}):(0,t.jsx)("img",{src:o,alt:"Preview",className:"max-w-full max-h-full object-contain rounded-lg shadow-md"}):(0,t.jsxs)("div",{className:"text-muted-foreground flex flex-col items-center gap-2",children:["failed"===u.status?(0,t.jsx)(tt,{className:"h-8 w-8 text-destructive"}):(0,t.jsx)(et.Loader2,{className:"h-8 w-8 animate-spin"}),(0,t.jsx)("span",{className:"text-sm",children:u.status})]})}),u.result?.images&&u.result.images.length>1&&(0,t.jsx)("div",{className:"h-20 bg-black/10 flex items-center gap-2 p-2 shrink-0 overflow-x-auto justify-center border-t border-white/10",children:u.result.images.map((e,s)=>{let a=td(e);return(0,t.jsx)("div",{className:`relative h-14 w-14 rounded-md overflow-hidden cursor-pointer border-2 transition-all hover:scale-105 ${_===s?"border-primary ring-2 ring-primary/30":"border-transparent opacity-70 hover:opacity-100"}`,onClick:()=>S(s),children:a.toLowerCase().endsWith(".mp4")?(0,t.jsx)("div",{className:"w-full h-full bg-black flex items-center justify-center",children:(0,t.jsx)(ta,{className:"w-6 h-6 text-white/80"})}):(0,t.jsx)("img",{src:a,alt:`Thumbnail ${s+1}`,className:"w-full h-full object-cover"})},s)})})]}),(0,t.jsxs)("div",{className:"h-[280px] flex-shrink-0 border-t bg-background p-6 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"font-semibold text-lg",children:"任务详情"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground px-2 py-0.5 rounded-full bg-muted border",children:new Date(u.created_at).toLocaleString()})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{variant:"destructive",size:"sm",onClick:()=>u&&P(u.id),children:[(0,t.jsx)(ti.Trash2,{className:"w-4 h-4 mr-2"}),"删除"]}),(0,t.jsxs)(r.Button,{size:"sm",variant:"saved"===u.status?"secondary":"default",onClick:()=>u&&T(u),disabled:g||"success"!==u.status,className:"saved"===u.status?"bg-green-100 text-green-700 hover:bg-green-200":"",children:[g?(0,t.jsx)(et.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}):(0,t.jsx)(tr,{className:"w-4 h-4 mr-2"}),"saved"===u.status?"已收藏":"收藏"]}),(0,t.jsxs)(r.Button,{size:"sm",onClick:()=>l(u),children:[(0,t.jsx)(ts.Sparkles,{className:"w-4 h-4 mr-2"}),"应用此参数"]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(i.Label,{className:"text-xs text-muted-foreground",children:"模型 (Model)"}),(0,t.jsx)("div",{className:"text-sm font-medium",children:u.params?.model||"N/A"})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(i.Label,{className:"text-xs text-muted-foreground",children:"比例 (Ratio)"}),(0,t.jsx)("div",{className:"text-sm font-medium",children:u.params?.ratio||"N/A"})]})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(i.Label,{className:"text-xs text-muted-foreground",children:"参考图"}),u.params?.images?.length>0||u.params?.imageUrls?.length>0?(0,t.jsx)("div",{className:"flex gap-2 flex-wrap",children:(u.params?.images||u.params?.imageUrls||[]).map((e,s)=>{let a="string"==typeof e?e:e.url;return a&&!a.startsWith("http")&&(a=`https://${a}`),(0,t.jsx)("div",{className:"h-16 w-16 rounded-md overflow-hidden border bg-muted/20",children:(0,t.jsx)("img",{src:a,alt:"Ref",className:"h-full w-full object-cover"})},s)})}):(0,t.jsx)("div",{className:"text-sm text-muted-foreground italic",children:"无参考图"})]})}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(i.Label,{className:"text-xs text-muted-foreground",children:"提示词 (Prompt)"}),(0,t.jsx)("div",{className:"text-sm p-3 rounded-md bg-muted/50 border h-[140px] overflow-y-auto whitespace-pre-wrap scrollbar-thin",children:u.params?.prompt||"N/A"})]})]})]})]}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:"请选择左侧记录查看详情"})}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col h-full bg-background min-w-[300px]",children:[(0,t.jsxs)(eq.DialogHeader,{className:"px-6 py-4 border-b flex-shrink-0 flex-col space-y-3",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between w-full",children:[(0,t.jsx)(eq.DialogTitle,{children:"生成记录"}),(0,t.jsx)("div",{className:"flex items-center space-x-3",children:w?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:L,disabled:k,children:"取消"}),(0,t.jsxs)(r.Button,{variant:"destructive",size:"sm",onClick:R,disabled:0===y.size||k,children:[k?(0,t.jsx)(et.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}):(0,t.jsx)(ti.Trash2,{className:"w-4 h-4 mr-2"}),"删除选中 (",y.size,")"]})]}):(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:L,children:[(0,t.jsx)(tn,{className:"w-4 h-4 mr-2"}),"批量删除"]})})]}),(0,t.jsxs)("div",{className:"w-full flex items-center justify-between gap-2",children:[(0,t.jsx)(eZ,{value:x,onValueChange:e=>f(e),className:"flex-1",children:(0,t.jsxs)(e7,{className:"grid w-full grid-cols-4 h-9 bg-muted/50 p-1",children:[(0,t.jsx)(e9,{value:"all",className:"text-xs",onClick:()=>E("all"),children:"全部"}),(0,t.jsx)(e9,{value:"video",className:"text-xs",onClick:()=>E("video"),children:"视频"}),(0,t.jsx)(e9,{value:"image",className:"text-xs",onClick:()=>E("image"),children:"图片"}),(0,t.jsx)(e9,{value:"saved",className:"text-xs",onClick:()=>E("saved"),children:"收藏"})]})}),!w&&(0,t.jsxs)("div",{className:"flex items-center space-x-2 bg-muted rounded-lg px-2 py-1 h-9",children:[(0,t.jsx)(i.Label,{htmlFor:"show-success",className:"text-xs font-medium cursor-pointer whitespace-nowrap",children:"仅看成功"}),(0,t.jsx)("div",{id:"show-success",className:`w-8 h-4 rounded-full p-0.5 cursor-pointer transition-colors ${h?"bg-primary":"bg-muted-foreground/30"}`,onClick:()=>p(!h),children:(0,t.jsx)("div",{className:`w-3 h-3 bg-white dark:bg-black rounded-full shadow-sm transition-transform ${h?"translate-x-4":"translate-x-0"}`})})]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,t.jsx)("div",{className:"p-4",children:0===M.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-20 text-muted-foreground gap-4",children:[(0,t.jsx)("div",{className:"p-4 bg-muted/30 rounded-full",children:(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-8 w-8 opacity-50",children:[(0,t.jsx)("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"}),(0,t.jsx)("path",{d:"M3 3v9h9"}),(0,t.jsx)("path",{d:"M12 7v5l4 2"})]})}),(0,t.jsx)("p",{className:"text-sm",children:"暂无记录"})]}):(0,t.jsxs)(t.Fragment,{children:[w&&(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4 px-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(te.Checkbox,{id:"select-all",checked:y.size===M.length&&M.length>0,onCheckedChange:()=>{y.size===M.length?N(new Set):N(new Set(M.map(e=>e.id)))}}),(0,t.jsx)(i.Label,{htmlFor:"select-all",className:"text-sm cursor-pointer",children:"全选当前页"})]}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["已选 ",y.size," 项"]})]}),(0,t.jsx)("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-3",children:M.map(e=>{let s=e.result?.images?.[0]?td(e.result.images[0]):null,a="success"===e.status,i="failed"===e.status,r="saved"===e.status,l=new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),n=w?y.has(e.id):u?.id===e.id;return(0,t.jsxs)("div",{className:`group relative aspect-square bg-muted/20 border-2 rounded-xl overflow-hidden cursor-pointer transition-all ${n?w?"border-primary bg-primary/5":"border-primary shadow-md scale-[0.98]":"border-transparent hover:border-primary/50"}`,onClick:()=>{if(w){var t;let s;t=e.id,(s=new Set(y)).has(t)?s.delete(t):s.add(t),N(s)}else m(e)},children:[w&&(0,t.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,t.jsx)("div",{className:`h-5 w-5 rounded-md border shadow-sm flex items-center justify-center transition-colors ${n?"bg-primary border-primary":"bg-black/40 border-white/50 hover:bg-black/60"}`,children:n&&(0,t.jsx)(tn,{className:"h-3.5 w-3.5 text-white"})})}),s?s.toLowerCase().endsWith(".mp4")?(0,t.jsxs)("div",{className:"w-full h-full bg-black/5 relative",children:[(0,t.jsx)("video",{src:s,className:"w-full h-full object-cover",muted:!0,playsInline:!0}),(0,t.jsx)("div",{className:"absolute top-1 right-1 bg-black/40 rounded-full p-1",children:(0,t.jsx)(ta,{className:"w-3 h-3 text-white fill-white"})})]}):(0,t.jsx)("img",{src:s,alt:"Thumbnail",loading:"lazy",className:"w-full h-full object-cover transition-transform group-hover:scale-105"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground bg-muted/30",children:i?(0,t.jsx)(tt,{className:"h-8 w-8 text-destructive/50"}):(0,t.jsx)(et.Loader2,{className:"h-8 w-8 animate-spin"})}),(0,t.jsxs)("div",{className:"absolute top-2 right-2 pointer-events-none",children:[i&&(0,t.jsx)("div",{className:"bg-red-500/80 text-white text-[10px] px-2 py-0.5 rounded-full",children:"Failed"}),r&&(0,t.jsx)(tl,{className:"w-4 h-4 text-yellow-400 fill-yellow-400 drop-shadow-md"}),!a&&!i&&!r&&(0,t.jsx)("div",{className:"bg-blue-500/80 text-white text-[10px] px-2 py-0.5 rounded-full animate-pulse",children:"Run"})]}),!w&&(0,t.jsx)("div",{className:"absolute top-1.5 right-1.5 opacity-0 group-hover:opacity-100 transition-opacity z-10",onClick:t=>{t.stopPropagation(),P(e.id)},children:(0,t.jsx)("div",{className:"bg-background/80 hover:bg-destructive hover:text-destructive-foreground p-1.5 rounded-full backdrop-blur-sm transition-colors cursor-pointer shadow-sm border",children:(0,t.jsx)(ti.Trash2,{className:"w-3.5 h-3.5"})})}),(0,t.jsxs)("div",{className:`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2 pt-6 flex justify-between items-end transition-opacity ${n&&!w?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:[(0,t.jsx)("span",{className:"text-white text-[10px] font-medium truncate max-w-[60%]",children:e.params?.model?.split("-")[1]||"Unknown"}),(0,t.jsx)("span",{className:"text-white/70 text-[10px]",children:l})]})]},e.id)})})]})})})]})]}),(0,t.jsxs)(eq.DialogClose,{className:"absolute -top-3 -right-3 z-50 p-2 bg-background rounded-full border shadow-md hover:bg-muted transition-colors focus:outline-none",children:[(0,t.jsx)(ee.X,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})})}var tu=e.i(773955),tm=e.i(618566);let th=e=>new Promise((t,s)=>{let a=document.createElement("video");a.preload="auto",a.muted=!0,a.onloadeddata=()=>{a.currentTime=.1},a.onseeked=()=>{let e=document.createElement("canvas");e.width=a.videoWidth,e.height=a.videoHeight;let s=e.getContext("2d");s?(s.drawImage(a,0,0,e.width,e.height),e.toBlob(e=>{t({duration:a.duration,width:a.videoWidth,height:a.videoHeight,coverBlob:e||void 0})},"image/jpeg",.7)):t({duration:a.duration,width:a.videoWidth,height:a.videoHeight})},a.onerror=()=>s("Failed to load video metadata"),a.src=e});var tp=e.i(313096),tx=e.i(503116);function tf({tasks:e,activeTaskId:s,onSelectTask:a,onImageSelect:i}){let r=e.filter(e=>!e.result?.images?.includes("delete"));return(0,t.jsx)("div",{className:"w-auto min-w-[200px] max-w-[75%] px-2 py-2 bg-muted/10 border rounded-xl flex-shrink-0 overflow-hidden transition-all duration-300",children:(0,t.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-muted-foreground/20 hover:scrollbar-thumb-muted-foreground/40 -mb-2 min-h-[80px]",children:[r.map(e=>{let r=s===e.id,l="running"===e.status,n="queued"===e.status,o="submitting"===e.status||"processing"===e.status,d="failed"===e.status,c=td(e.result?.images?.[0]);return(0,t.jsx)("div",{className:`flex-shrink-0 h-20 w-20 rounded-md border-2 bg-muted/30 flex items-center justify-center cursor-pointer transition-colors overflow-hidden relative ${r?"border-primary":"border-muted hover:border-primary/50"}`,onClick:()=>{a(e.id),i(0)},children:n||o?(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[n?(0,t.jsx)(tx.Clock,{className:"h-6 w-6 text-primary animate-pulse"}):(0,t.jsx)(et.Loader2,{className:"h-6 w-6 animate-spin text-primary"}),(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground mt-1",children:o?"正在提交":"排队中"})]}):l?(0,t.jsx)(et.Loader2,{className:"h-6 w-6 animate-spin text-primary"}):d?(0,t.jsx)(tt,{className:"h-6 w-6 text-destructive"}):c?c.toLowerCase().endsWith(".mp4")?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("video",{src:c,className:"h-full w-full object-cover",muted:!0,playsInline:!0,onMouseOver:e=>e.currentTarget.play(),onMouseOut:e=>{e.currentTarget.pause(),e.currentTarget.currentTime=0}}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-black/10",children:(0,t.jsx)(ta,{className:"h-6 w-6 text-white/80 fill-white/50 drop-shadow-sm"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{src:c,referrerPolicy:"no-referrer",alt:`Task ${e.id}`,className:"h-full w-full object-cover"}),e.result?.images&&e.result.images.length>1&&(0,t.jsx)("div",{className:"absolute top-0.5 right-0.5 bg-black/50 text-white text-[10px] px-1 rounded-sm backdrop-blur-[1px]",children:e.result.images.length})]}):(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"?"})},e.id)}),0===e.length&&(0,t.jsx)("div",{className:"flex items-center justify-center w-full h-20 text-muted-foreground/40 text-xs px-4",children:"暂无生成记录"})]})})}var tg=e.i(373375),tv=e.i(463059),tb=e.i(952571),tw=e.i(688511),tj=e.i(440160),ty=e.i(728231);function tN({activeTask:e,queueState:a,generatedImages:i,selectedImageIndex:l,setSelectedImageIndex:n,setLightboxOpen:o,isSaving:d,onSaveTask:c,onUseAsReference:u,onDownloadImage:m,onOpenInfoDialog:h,mediaType:p}){let{t:x}=(0,tu.useI18n)(),f=(0,s.useMemo)(()=>td(i.length>0?i[l]:null),[i,l]),g=e?.status==="queued"&&a?.position===1;return(0,t.jsx)("div",{className:"flex-1 min-h-0 flex items-center justify-center w-full",children:(0,t.jsx)("div",{className:"h-full aspect-[16/9] bg-muted/10 border-2 border-dashed rounded-xl flex flex-col items-center justify-center relative shadow-sm overflow-hidden group",children:e?.status==="failed"?(0,t.jsxs)("div",{className:"flex flex-col items-center gap-3 p-6 text-center max-w-[80%]",children:[(0,t.jsx)(tt,{className:"h-10 w-10 text-destructive"}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-destructive",children:x("generation_failed")}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.result?.error||e.details?.error||x("unknown_error")})]})]}):e?.status==="running"||e?.status==="queued"||e?.status==="submitting"||e?.status==="processing"?(0,t.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[e?.status==="queued"?(0,t.jsx)(tx.Clock,{className:"h-10 w-10 text-primary animate-pulse"}):(0,t.jsx)(et.Loader2,{className:"h-10 w-10 animate-spin text-primary"}),(0,t.jsx)("div",{className:"flex flex-col items-center gap-1",children:e?.status==="queued"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:g?"正在提交":"排队中"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:g?"请勿刷新页面":a?x("queue_position",{position:a.position,total:a.total}):x("waiting_for_start")})]}):e?.status==="submitting"||e?.status==="processing"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground animate-pulse",children:"正在提交"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground animate-pulse",children:"请勿刷新页面"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground animate-pulse",children:"正在生成"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground animate-pulse",children:"请勿刷新页面"})]})})]}):f?f.toLowerCase().endsWith(".mp4")?(0,t.jsx)("video",{src:f,controls:!0,className:"w-full h-full object-contain"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{src:f,referrerPolicy:"no-referrer",alt:"Generated",className:"w-full h-full object-contain cursor-pointer",onClick:()=>o(!0)}),i.length>1&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/20 hover:bg-black/40 text-white rounded-full h-8 w-8",onClick:e=>{e.stopPropagation(),n(e=>(e-1+i.length)%i.length)},children:(0,t.jsx)(tg.ChevronLeft,{className:"h-4 w-4"})}),(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/20 hover:bg-black/40 text-white rounded-full h-8 w-8",onClick:e=>{e.stopPropagation(),n(e=>(e+1)%i.length)},children:(0,t.jsx)(tv.ChevronRight,{className:"h-4 w-4"})}),(0,t.jsx)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 p-1.5 rounded-xl bg-black/40 backdrop-blur-md max-w-[90%] overflow-x-auto scrollbar-thin scrollbar-thumb-white/20 z-10",children:i.map((e,s)=>(0,t.jsx)("div",{onClick:e=>{e.stopPropagation(),n(s)},className:`relative h-10 w-10 rounded-md overflow-hidden cursor-pointer border-2 transition-all flex-shrink-0 ${s===l?"border-white scale-105 shadow-md":"border-transparent opacity-60 hover:opacity-100"}`,children:(0,t.jsx)("img",{src:e,className:"h-full w-full object-cover",alt:`Variant ${s+1}`})},s))})]}),(0,t.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)(ty.TooltipProvider,{children:(0,t.jsxs)(ty.Tooltip,{children:[(0,t.jsx)(ty.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(r.Button,{variant:"secondary",size:"icon",className:`h-8 w-8 rounded-full shadow-md bg-background/80 backdrop-blur-sm ${e?.status==="saved"?"text-yellow-500 hover:text-yellow-600":""}`,onClick:()=>e&&c(e),disabled:d,children:d?(0,t.jsx)(et.Loader2,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(tr,{className:`h-4 w-4 ${e?.status==="saved"?"fill-current":""}`})})}),(0,t.jsx)(ty.TooltipContent,{children:(0,t.jsx)("p",{children:x(e?.status==="saved"?"tooltip_favorite_saved":"tooltip_favorite")})})]})}),(0,t.jsx)(ty.TooltipProvider,{children:(0,t.jsxs)(ty.Tooltip,{children:[(0,t.jsx)(ty.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(r.Button,{variant:"secondary",size:"icon",className:"h-8 w-8 rounded-full shadow-md bg-background/80 backdrop-blur-sm",onClick:()=>h(!0),children:(0,t.jsx)(tb.Info,{className:"h-4 w-4"})})}),(0,t.jsx)(ty.TooltipContent,{children:(0,t.jsx)("p",{children:x("tooltip_info")})})]})}),(0,t.jsx)(ty.TooltipProvider,{children:(0,t.jsxs)(ty.Tooltip,{children:[(0,t.jsx)(ty.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(r.Button,{variant:"secondary",size:"icon",className:"h-8 w-8 rounded-full shadow-md bg-background/80 backdrop-blur-sm",onClick:u,children:(0,t.jsx)(tw.Edit,{className:"h-4 w-4"})})}),(0,t.jsx)(ty.TooltipContent,{children:(0,t.jsx)("p",{children:x("tooltip_edit")})})]})}),(0,t.jsx)(ty.TooltipProvider,{children:(0,t.jsxs)(ty.Tooltip,{children:[(0,t.jsx)(ty.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(r.Button,{variant:"secondary",size:"icon",className:"h-8 w-8 rounded-full shadow-md bg-background/80 backdrop-blur-sm",onClick:m,children:(0,t.jsx)(tj.Download,{className:"h-4 w-4"})})}),(0,t.jsx)(ty.TooltipContent,{children:(0,t.jsx)("p",{children:x("tooltip_download")})})]})})]})]}):(0,t.jsxs)(t.Fragment,{children:["image"===p?(0,t.jsx)(Q,{className:"h-16 w-16 text-muted-foreground/20 mb-4"}):(0,t.jsx)(Z.Video,{className:"h-16 w-16 text-muted-foreground/20 mb-4"}),(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:x("preview_area")}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:x("preview_desc")})]})]})})})}let tk=(0,Y.default)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var tC=e.i(184762);function t_({prompt:e,setPrompt:s,generateModel:a}){let{t:l}=(0,tu.useI18n)();return(0,t.jsxs)("div",{className:"flex-1 px-4 pb-2 pt-0 flex flex-col min-h-[60px] relative",children:[!a.includes("video")&&!a.includes("sora")&&!a.includes("hailuo")&&!a.includes("vidu")&&!a.includes("seedance")&&!a.includes("grok")&&!a.includes("wan")&&!a.includes("veo")&&(0,t.jsx)(i.Label,{className:"mb-2",children:l("prompt")}),(0,t.jsxs)("div",{className:"relative flex-1 border rounded-md focus-within:ring-1 focus-within:ring-ring bg-background overflow-hidden",children:[(0,t.jsx)(tC.Textarea,{placeholder:a.includes("veo")?"为了保证输出质量与成功，请使用英文提示词":a.includes("sora-2")?"不支持上传包含真实人物的图像":l("prompt_placeholder_generate"),className:"w-full h-[calc(100%-36px)] resize-none border-0 focus-visible:ring-0 shadow-none p-3 bg-transparent",value:e,onChange:e=>s(e.target.value)}),(0,t.jsx)("div",{className:"h-9 flex items-center justify-end px-2",children:(0,t.jsx)(ty.TooltipProvider,{children:(0,t.jsxs)(ty.Tooltip,{delayDuration:300,children:[(0,t.jsx)(ty.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("span",{className:"inline-block",tabIndex:0,children:(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",disabled:!0,className:"h-7 px-2 text-xs gap-1.5 text-muted-foreground hover:text-foreground cursor-not-allowed",onClick:()=>{console.log("Optimize prompt clicked")},children:[(0,t.jsx)(tk,{className:"h-3.5 w-3.5"}),l("prompt_optimize")]})})}),(0,t.jsx)(ty.TooltipContent,{children:(0,t.jsx)("p",{children:l("prompt_optimize_coming_soon")})})]})})})]})]})}var tS=e.i(62870);function tP({mediaType:e,setMediaType:s,modelPricing:a,generateModel:r,setGenerateModel:l,availableModels:n,checkModelAccess:o,wanMode:d,setWanMode:c,veoMode:u,setVeoMode:m,hailuoMode:h,setHailuoMode:p,setAspectRatio:x,setDuration:f,setGrokMode:g,videoFilter:v,setVideoFilter:b}){let{t:w}=(0,tu.useI18n)(),j="google-nanobananapro"===r||"google-nanobananapro-2k"===r||"google-nanobananapro-4k"===r,y=r.includes("gpt-image-v1-5");return(0,t.jsxs)("div",{className:"space-y-4",children:["video"===e&&(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center w-full",children:[{id:"all",label:"全部"},{id:"first_frame",label:"仅首帧"},{id:"first_last_frame",label:"首尾帧"},{id:"reference_image",label:"参考图"},{id:"audio_sync",label:"音画同步"},{id:"theme_library",label:"视频编辑"}].map(e=>(0,t.jsx)("button",{onClick:()=>{var t;b(t=e.id),"first_frame"===t?(l("sora-2"),p("2.3"),c?.("first_frame")):"first_last_frame"===t?(l("veo3.1-fast"),p("02"),m("frames")):"reference_image"===t?(l("veo3.1-fast"),m("reference")):"audio_sync"===t?l("sora-2"):"theme_library"===t&&(l("wan2.6"),c?.("video_ref"))},className:(0,G.cn)("flex-1 px-2 py-1 text-[10px] sm:text-xs font-medium rounded-md transition-all truncate",v===e.id?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"),children:e.label},e.id))}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:w("model")}),(0,t.jsxs)(tS.Select,{value:j?"google-nanobananapro":y?"gpt-image-v1-5":r,onValueChange:e=>{l(e),e.includes("hailuo")&&("first_frame"===v?p("2.3"):"first_last_frame"===v&&p("02")),e.includes("veo3.1")&&("first_last_frame"===v?m("frames"):"reference_image"===v&&m("reference")),e.includes("wan2.6")&&("first_frame"===v?c?.("first_frame"):"theme_library"===v&&c?.("video_ref"))},children:[(0,t.jsx)(tS.SelectTrigger,{className:"h-8 w-[240px]",children:(0,t.jsx)(tS.SelectValue,{placeholder:w("select_model_placeholder")})}),(0,t.jsx)(tS.SelectContent,{children:n.filter(t=>{if(t.id.includes("google-nanobananapro-2k")||t.id.includes("google-nanobananapro-4k"))return!1;if("video"===e){if("first_frame"===v)return["sora-2","hailuo","grok-imagine","wan2.6"].includes(t.id);if("first_last_frame"===v)return["veo3.1","veo3.1-fast","hailuo","vidu-q2","seedance-v1-5-pro"].includes(t.id);if("reference_image"===v)return["veo3.1","veo3.1-fast"].includes(t.id);if("audio_sync"===v)return!(t.id.includes("hailuo")||t.id.includes("vidu"));if("theme_library"===v)return["wan2.6"].includes(t.id)}return!0}).map(e=>{let{allowed:s,labelSuffix:a}=o(e.id);return(0,t.jsx)(tS.SelectItem,{value:e.id,disabled:!s,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.logo&&(0,t.jsx)("img",{src:e.logo,alt:e.title,className:(0,G.cn)("w-4 h-4 object-contain",(e.id.includes("gpt")||e.id.includes("vidu")||e.id.includes("grok")||e.id.includes("sora"))&&"dark:invert")}),(0,t.jsxs)("span",{children:[e.title,a]})]})},e.id)})})]})]}),r.includes("wan2.6")&&c&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"模式"}),(0,t.jsxs)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:["theme_library"!==v&&(0,t.jsx)("button",{onClick:()=>c("first_frame"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"first_frame"===d?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"首帧"}),"first_frame"!==v&&(0,t.jsx)("button",{onClick:()=>c("video_ref"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"video_ref"===d?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"参考视频"})]})]}),r.includes("veo3.1")&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"模式"}),(0,t.jsxs)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:[("first_last_frame"===v||"all"===v||"first_frame"===v||"theme_library"===v||"audio_sync"===v)&&(0,t.jsx)("button",{onClick:()=>m("frames"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"frames"===u?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"首尾帧"}),("reference_image"===v||"all"===v||"first_frame"===v||"theme_library"===v||"audio_sync"===v)&&(0,t.jsx)("button",{onClick:()=>m("reference"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"reference"===u?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"参考图"})]})]}),r.includes("hailuo")&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"模式"}),(0,t.jsxs)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:[("first_frame"===v||"all"===v||"theme_library"===v||"reference_image"===v)&&(0,t.jsx)("button",{onClick:()=>p("2.3"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"2.3"===h?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"2.3"}),("first_last_frame"===v||"all"===v||"theme_library"===v||"reference_image"===v)&&(0,t.jsx)("button",{onClick:()=>p("02"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"02"===h?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"02"})]})]})]})}var tT=e.i(569074);function tL({generateModel:e,mediaType:s,wanMode:a,veoMode:r,hailuoMode:l,optMode:n,uploadedImages:o,handleImageUpload:d,uploadAtIndex:c,removeImage:u,setLightboxImage:m,setLightboxOpen:h}){let{t:p}=(0,tu.useI18n)(),{toast:x}=(0,to.useToast)();if("midjourney"===e)return null;let f=e.includes("veo3.1")&&"frames"===r||e.includes("seedance")||e.includes("hailuo")||e.includes("vidu-q2")||e.includes("wan2.6");return(0,t.jsxs)("div",{className:"space-y-3",children:[!e.includes("veo3.1")&&!e.includes("seedance")&&!e.includes("hailuo")&&!e.includes("vidu-q2")&&!e.includes("wan2.6")&&(0,t.jsx)(i.Label,{children:p("upload_reference_image")}),f?(0,t.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[0,1].map(s=>{let i=o[s],r=0===s,n=e.includes("wan2.6")&&"video_ref"===a;return e.includes("hailuo")&&"2.3"===l&&1===s||e.includes("wan2.6")&&("first_frame"===a&&1===s||1===s&&!o[0])?null:(0,t.jsx)("div",{className:"space-y-1.5",children:i?(0,t.jsxs)("div",{className:"relative aspect-[3/2] rounded-lg overflow-hidden border bg-muted/30 group",children:[n&&(i.file?.type.startsWith("video")||i.url.startsWith("http"))?(0,t.jsx)("video",{src:i.url,className:"w-full h-full object-contain",controls:!0,style:{backgroundColor:"#000"}}):(0,t.jsx)("img",{src:i.url,referrerPolicy:"no-referrer",alt:"preview",className:"w-full h-full object-contain",style:{backgroundColor:"#f0f0f0"}}),i.uploading&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:(0,t.jsx)("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-primary border-t-transparent"})}),!i.uploading&&(0,t.jsx)("button",{onClick:()=>u(s),className:"absolute top-1 right-1 bg-black/50 hover:bg-black/70 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(ee.X,{className:"w-3 h-3"})})]}):(0,t.jsxs)("label",{className:"flex flex-col items-center justify-center aspect-[3/2] border-2 border-dashed rounded-lg cursor-pointer hover:bg-muted/50 transition-colors",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation();let t=e.dataTransfer.files;if(t&&t.length>0){let e=t[0];if(n){if(!e.type.startsWith("video/"))return void x({title:"格式错误",description:"此处仅支持上传视频文件",variant:"destructive"})}else if(!e.type.startsWith("image/"))return void x({title:"格式错误",description:"此处仅支持上传图片文件",variant:"destructive"});c(s,e)}},children:[(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,t.jsx)(tT.Upload,{className:"w-5 h-5 mb-1 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:e.includes("wan2.6")&&"video_ref"===a?"上传视频":e.includes("wan2.6")&&"first_frame"===a?"上传首帧":r?"上传起始帧":"上传结束帧"})]}),(0,t.jsx)("input",{type:"file",className:"hidden",accept:n?"video/mp4, video/quicktime, video/webm":e.includes("veo3.1")?"image/jpeg, image/png":"image/jpeg, image/png, image/webp",onChange:e=>{e.target.files&&e.target.files.length>0&&c(s,e.target.files[0])}})]})},s)})}):(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-2",children:[o.map((e,s)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-lg overflow-hidden border bg-muted/30 group",children:[e.file?.type.startsWith("video")?(0,t.jsx)("video",{src:e.url,className:"w-full h-full object-cover"}):(0,t.jsx)("img",{src:e.url,referrerPolicy:"no-referrer",alt:"preview",className:"w-full h-full object-contain cursor-zoom-in",style:{backgroundColor:"#f0f0f0"},onClick:()=>{m(e.url),h(!0)}}),e.uploading&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:(0,t.jsx)("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-primary border-t-transparent"})}),!e.uploading&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),u(s)},className:"absolute top-1 right-1 bg-black/50 hover:bg-black/70 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(ee.X,{className:"w-3 h-3"})})]},s)),o.length<("image"===s||e.includes("veo3.1")&&"reference"===r?e.includes("grok-imagine")||e.includes("image-optimization")?1:e.includes("nanobanana")||e.includes("seedream")||e.includes("gpt-image")?5:3:1)&&(0,t.jsxs)("label",{htmlFor:"dropzone-file",className:"flex flex-col items-center justify-center border-2 border-dashed rounded-lg cursor-pointer hover:bg-muted/50 transition-colors aspect-square col-span-1 relative group/upload",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation();let t=e.dataTransfer.files;t&&t.length>0&&d({target:{files:t,value:""}})},children:[(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,t.jsx)(tT.Upload,{className:"w-6 h-6 text-muted-foreground"}),(0,t.jsx)("div",{className:"absolute top-1 right-1 opacity-0 group-hover/upload:opacity-100 transition-opacity",children:(0,t.jsx)(ty.TooltipProvider,{children:(0,t.jsxs)(ty.Tooltip,{children:[(0,t.jsx)(ty.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:"p-1 rounded-full bg-background/80 backdrop-blur-sm shadow-sm hover:bg-background cursor-help",children:(0,t.jsx)(tb.Info,{className:"w-3 h-3 text-muted-foreground"})})}),(0,t.jsxs)(ty.TooltipContent,{side:"top",className:"max-w-[200px] text-xs",children:[(0,t.jsx)("p",{children:p(e.includes("veo")&&(!e.includes("veo3.1")||"frames"===r)?"upload_start_frame":"upload_drag_drop")}),!e.includes("veo")&&!e.includes("sora-2")&&(0,t.jsx)("p",{className:"mt-1 opacity-80",children:e.includes("grok-imagine")?"支持 JPG, PNG, WEBP，单图 < 10MB，最多 1 张":e.includes("image-optimization")?"lossless"===n?"支持 JPG, PNG, BMP，单图 < 3MB":"支持 JPG, PNG, BMP，单图 < 7MB":p("image"===s?"upload_image_hint":"upload_video_hint")}),e.includes("sora-2")&&(0,t.jsx)("p",{className:"mt-1 text-destructive font-medium",children:"不支持上传包含真实人物的图像"})]})]})})})]}),(0,t.jsx)("input",{id:"dropzone-file",type:"file",className:"hidden",multiple:"image"===s&&!e.includes("veo")&&!e.includes("image-optimization")||e.includes("veo3.1")&&"reference"===r,accept:e.includes("veo3.1")?"image/jpeg, image/png":e.includes("image-optimization")?"image/jpeg, image/png, image/bmp":"image/jpeg, image/png, image/webp",onChange:d})]})]})]})}let tR={"1:1":"2048*2048","4:3":"2304*1728","3:4":"1728*2304","16:9":"2560*1440","9:16":"1440*2560","3:2":"2496*1664","2:3":"1664*2496","21:9":"3024*1296"},tM=({ratio:e})=>{if("original"===e)return(0,t.jsx)("div",{className:"w-3.5 h-3.5 border border-current rounded-sm opacity-50"});let[s,a]=e.split(":").map(Number);if(!s||!a)return null;let i=14,r=14;return s>a?r=14*a/s:a>s&&(i=14*s/a),(0,t.jsx)("div",{className:"border-[1.5px] border-current rounded-[1px] opacity-70",style:{width:`${i}px`,height:`${r}px`}})};function tE({generateModel:e,setGenerateModel:a,mediaType:l,modelPricing:n,checkModelAccess:o,userRole:d,grokResolution:c,setGrokResolution:u,grokMode:m,setGrokMode:h,quality:p,setQuality:x,optMode:f,setOptMode:g,resolution:v,setResolution:b,prompt:w,mjModel:j,setMjModel:y,mjMode:N,setMjMode:k,mjSpeed:C,setMjSpeed:_,hailuoMode:S,setHailuoMode:P,hailuoResolution:T,setHailuoResolution:L,seedanceResolution:R,setSeedanceResolution:M,veoResolution:E,setVeoResolution:D,aspectRatio:z,setAspectRatio:$,duration:I,setDuration:U,count:A,setCount:W,aspectRatios:F,pricingMap:O,userPoints:q,dailyLimit:B,dailyUsage:H,imageConcurrency:K,videoConcurrency:V,runningImageCount:G,runningVideoCount:X,queuedImageCount:J,queuedVideoCount:Y,tasks:Q,isUploading:Z,isSubmitting:ee,isGenerating:es,handleGenerate:ea,wanMode:ei,setWanMode:er,wanResolution:el,setWanResolution:en}){let{t:eo}=(0,tu.useI18n)(),ed="google-nanobananapro"===e||"google-nanobananapro-2k"===e||"google-nanobananapro-4k"===e,ec=(0,s.useMemo)(()=>ed?e.includes("4k")?"4K":e.includes("2k")?"2K":"1K":null,[e,ed]);return(0,t.jsxs)("div",{className:"px-4 py-3 bg-background/80 backdrop-blur-sm flex-shrink-0 space-y-3",children:[e.includes("hailuo")&&(0,t.jsx)("div",{className:"space-y-3 pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"分辨率"}),(0,t.jsxs)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:[(0,t.jsx)("button",{onClick:()=>L?.("768P"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"768P"===T?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"768P"}),(0,t.jsx)("button",{onClick:()=>L?.("1080P"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"1080P"===T?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"1080P"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"时长"}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:(0,t.jsx)("button",{className:"px-3 py-1 text-xs font-medium rounded-md transition-all bg-white shadow-sm text-black cursor-default",children:"6s"})})]})]})}),e.includes("vidu-q2")&&(0,t.jsx)("div",{className:"space-y-3 pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"分辨率"}),(0,t.jsxs)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:[(0,t.jsx)("button",{onClick:()=>L?.("720P"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"720P"===T?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"720P"}),(0,t.jsx)("button",{onClick:()=>L?.("1080P"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"1080P"===T?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"1080P"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"时长"}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:["4s","8s"].map(e=>(0,t.jsx)("button",{onClick:()=>U(e),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${I===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:e},e))})]})]})}),e.includes("veo3.1")&&(0,t.jsx)("div",{className:"space-y-3 pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"分辨率"}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:e.includes("fast")?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),D("1K")},onPointerDown:e=>{e.preventDefault(),e.stopPropagation(),D("1K")},className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"1K"===String(E||"").toUpperCase()?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"1K"}),(0,t.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),D("4K")},onPointerDown:e=>{e.preventDefault(),e.stopPropagation(),D("4K")},className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"4K"===String(E||"").toUpperCase()?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"4K"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),D("720P")},className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"720P"===String(E||"").toUpperCase()?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"720P"}),(0,t.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),D("1080P")},className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"1080P"===String(E||"").toUpperCase()?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"1080P"})]})})]})}),e.includes("veo3.1")&&(0,t.jsx)("div",{className:"space-y-3 pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("aspect_ratio")}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:F.map(e=>(0,t.jsxs)("button",{onClick:()=>$(e),className:`px-2 py-1 text-xs font-medium rounded-md transition-all flex items-center gap-1 ${z===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:[(0,t.jsx)("div",{className:"w-3 h-3 flex items-center justify-center",children:(0,t.jsx)(tM,{ratio:e})}),e]},e))})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"时长"}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:e.includes("fast")?(0,t.jsx)("button",{className:"px-3 py-1 text-xs font-medium rounded-md transition-all bg-white shadow-sm text-black cursor-default",children:"8s"}):["4s","8s"].map(e=>(0,t.jsx)("button",{onClick:()=>U(e),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${I===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:e},e))})]})]})}),e.includes("grok-imagine")&&(0,t.jsx)("div",{className:"space-y-3 pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"分辨率"}),(0,t.jsxs)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:[(0,t.jsx)("button",{onClick:()=>u("360P"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"360P"===c?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"360P"}),(0,t.jsx)("button",{onClick:()=>u("720P"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"720P"===c?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"720P"})]})]})}),e.includes("grok-imagine")&&(0,t.jsx)("div",{className:"space-y-3 pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"模式"}),(0,t.jsxs)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:[(0,t.jsx)("button",{onClick:()=>h("fun"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"fun"===m?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"Fun"}),(0,t.jsx)("button",{onClick:()=>h("normal"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"normal"===m?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"Normal"}),(0,t.jsx)("button",{onClick:()=>h("spicy"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"spicy"===m?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"Spicy"})]})]})}),e.includes("gpt-image-v1-5")&&(0,t.jsx)("div",{className:"space-y-3 pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("quality")||"Quality"}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:["auto","high","medium","low"].map(e=>(0,t.jsx)("button",{onClick:()=>x?.(e),className:`px-3 py-1 text-xs font-medium rounded-md transition-all capitalize ${p===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:e},e))})]})}),e.includes("image-optimization")&&(0,t.jsx)("div",{className:"space-y-3 pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("optimization_mode")}),(0,t.jsxs)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:[(0,t.jsxs)("button",{onClick:()=>g?.("lossless"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all flex items-center gap-1 ${"lossless"===f?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:[eo("optimization_mode_lossless"),(0,t.jsx)(ty.TooltipProvider,{children:(0,t.jsxs)(ty.Tooltip,{delayDuration:0,children:[(0,t.jsx)(ty.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("span",{className:"cursor-help",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(tt,{className:"w-3 h-3 opacity-70 hover:opacity-100"})})}),(0,t.jsx)(ty.TooltipContent,{className:"max-w-[220px] text-xs",children:(0,t.jsx)("p",{children:"最大可达到4K，可以先使用清晰度增强，然后放大效果更好"})})]})})]}),(0,t.jsx)("button",{onClick:()=>g?.("clarity"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"clarity"===f?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:eo("optimization_mode_clarity")})]})]})}),"midjourney"===e&&(0,t.jsxs)("div",{className:"space-y-3 pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("mj_model_version")}),(0,t.jsxs)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:[(0,t.jsx)("button",{onClick:()=>y("v7"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"v7"===j?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"V7"}),(0,t.jsx)("button",{onClick:()=>y("niji 7"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"niji 7"===j?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"niji 7"})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("mj_mode")}),(0,t.jsxs)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:[(0,t.jsx)("button",{onClick:()=>k("draft"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"draft"===N?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"Draft"}),(0,t.jsx)("button",{onClick:()=>k("normal"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"normal"===N?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"Normal"})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("mj_speed")}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:(0,t.jsx)("button",{onClick:()=>_("fast"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${"fast"===C?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:"Fast"})})]})]}),ed&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("resolution")}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:["1K","2K","4K"].map(e=>{let s="google-nanobananapro";"2K"===e&&(s="google-nanobananapro-2k"),"4K"===e&&(s="google-nanobananapro-4k");let{allowed:i}=o(s);return i?(0,t.jsx)("button",{onClick:()=>{let t;return t="google-nanobananapro",void("2K"===e?t="google-nanobananapro-2k":"4K"===e&&(t="google-nanobananapro-4k"),a(t))},className:`px-3 py-1 text-xs font-medium rounded-md transition-all flex items-center gap-1 ${ec===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:e},e):(0,t.jsx)(ty.TooltipProvider,{children:(0,t.jsxs)(ty.Tooltip,{delayDuration:0,children:[(0,t.jsx)(ty.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("button",{onClick:()=>{},className:"px-3 py-1 text-xs font-medium rounded-md transition-all flex items-center gap-1 text-muted-foreground/40 cursor-not-allowed",children:[e,(0,t.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-yellow-500/70"})]})}),(0,t.jsx)(ty.TooltipContent,{children:(0,t.jsx)("p",{children:"T2会员模型"})})]})},e)})})]}),e.includes("wan2.6")&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium pt-2",children:eo("aspect_ratio")}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2 w-[240px]",children:F.map(e=>(0,t.jsxs)("button",{onClick:()=>$(e),className:`flex items-center justify-center gap-2 p-1 border rounded-md transition-all h-8 ${z===e?"bg-primary/5 border-primary text-primary":"bg-background hover:bg-muted/50 border-muted-foreground/20"}`,children:[(0,t.jsx)("div",{className:"w-3 h-3 flex items-center justify-center",children:(0,t.jsx)(tM,{ratio:e})}),(0,t.jsx)("span",{className:"text-xs",children:e})]},e))})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"分辨率"}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:["720P","1080P"].map(e=>(0,t.jsx)("button",{onClick:()=>en?.(e),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${el===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:e},e))})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("duration")||"Duration"}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:["5s","10s"].map(e=>(0,t.jsx)("button",{onClick:()=>U(e),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${I===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:e},e))})]})]})]}),e.includes("seedance")?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium pt-2",children:eo("aspect_ratio")}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2 w-[240px]",children:F.map(e=>(0,t.jsxs)("button",{onClick:()=>$(e),className:`flex items-center justify-center gap-2 p-1 border rounded-md transition-all h-8 ${z===e?"bg-primary/5 border-primary text-primary":"bg-background hover:bg-muted/50 border-muted-foreground/20"}`,children:[(0,t.jsx)("div",{className:"w-3 h-3 flex items-center justify-center",children:(0,t.jsx)(tM,{ratio:e})}),(0,t.jsx)("span",{className:"text-xs",children:e})]},e))})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("duration")||"Duration"}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:("1080P"===(R||"720P")?["4s","8s"]:["4s","8s","12s"]).map(e=>(0,t.jsx)("button",{onClick:()=>U(e),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${I===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:e},e))})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:"分辨率"}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:["720P","1080P"].map(e=>(0,t.jsx)("button",{onClick:()=>M?.(e),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${(R||"720P")===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:e},e))})]})]}):e.includes("sora-2")||e.includes("z-image")||e.includes("gpt-image-v1-5")?(0,t.jsxs)("div",{className:"flex items-center gap-2 justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("aspect_ratio")}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:F.filter(t=>!e.includes("gpt-image-v1-5")||["1:1","2:3","3:2"].includes(t)).map(e=>(0,t.jsxs)("button",{onClick:()=>$(e),className:`px-2 py-1 text-xs font-medium rounded-md transition-all flex items-center gap-1 ${z===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:[(0,t.jsx)("div",{className:"w-3 h-3 flex items-center justify-center",children:(0,t.jsx)(tM,{ratio:e})}),e]},e))})}),e.includes("sora-2")&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Label,{className:"text-xs font-medium text-muted-foreground shrink-0",children:eo("duration")||"Duration"}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:(e.includes("sora-2")?["10s","15s"]:["5s","10s"]).map(e=>(0,t.jsx)("button",{onClick:()=>U(e),className:`px-2 py-1 text-xs font-medium rounded-md transition-all ${I===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:e},e))})]})]}):(0,t.jsx)(t.Fragment,{children:!e.includes("grok-imagine")&&!e.includes("image-optimization")&&!e.includes("hailuo")&&!e.includes("vidu-q2")&&!e.includes("veo3.1")&&!e.includes("wan2.6")&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("aspect_ratio")}),(0,t.jsxs)(tS.Select,{value:z,onValueChange:$,children:[(0,t.jsx)(tS.SelectTrigger,{className:"h-8 w-[240px]",children:(0,t.jsx)(tS.SelectValue,{})}),(0,t.jsx)(tS.SelectContent,{children:F.map(s=>(0,t.jsx)(tS.SelectItem,{value:s,children:(0,t.jsxs)("div",{className:"flex items-center justify-between w-full min-w-[180px]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(tM,{ratio:s}),(0,t.jsx)("span",{children:"original"===s?eo("aspect_ratio_original"):s})]}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground ml-4",children:((e,t)=>{if("original"===e)return"";let s=tR[e];if(t.includes("nanobanana")||t.includes("midjourney")){let t={"1:1":"1024*1024","4:3":"1152*864","3:4":"864*1152","16:9":"1344*768","9:16":"768*1344","3:2":"1216*832","2:3":"832*1216","21:9":"1536*640","5:4":"1120*896","4:5":"896*1120"};t[e]&&(s=t[e])}return s||""})(s,e)})]})},s))})]})]})}),"image"===l&&!e.includes("image-optimization")&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-medium",children:eo("count")}),(0,t.jsx)("div",{className:"flex bg-muted p-1 rounded-lg h-8 items-center",children:[1,2,3,4].map(e=>(0,t.jsx)("button",{onClick:()=>W(e),disabled:!1,className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${A===e?"bg-white shadow-sm text-black":"text-muted-foreground hover:bg-background/50"}`,children:e},e))})]}),(()=>{let s=0,a=0,i="",u=O[e];void 0===u&&"wan2.6"===e&&void 0===(u=O["wan2.6"])&&console.warn("[Pricing] Wan 2.6 price not found in DB (checked 'wan-v2-6' and 'wan2.6')"),void 0===u&&e.includes("veo3.1")&&!e.includes("fast")&&(u="veo3.1"===e?150:100),void 0===u&&e.includes("seedance")&&(u="paid"===n?80:50),s=(void 0!==u?u:+("paid"===n))*A,e.includes("hailuo")&&"768P"===T&&(s=Math.ceil(.6*s)),e.includes("wan2.6")&&("10s"===I&&(s*=2),"1080P"===el&&(s*=2)),e.includes("veo3.1")&&!e.includes("fast")&&"8s"===I&&(s*=2),e.includes("veo3.1-fast")&&"4K"===String(E||"").toUpperCase()&&(s=Math.ceil(1.5*s)),e.includes("seedance")&&("8s"===I&&(s*=2),"12s"===I&&(s*=3),"1080P"===(R||"720P")&&(s*=2)),e.includes("vidu-q2")&&("720P"===T&&(s=Math.ceil(.6*s)),"8s"===I&&(s*=2)),e.includes("grok-imagine")&&"720P"===c&&(s=Math.ceil(1.5*s)),a=s,e.includes("sora-2")&&"15s"===I&&(a=Math.ceil(1.5*s));let m=(d||"").toUpperCase();("T4"===m||"T6"===m)&&"image"===l&&(s=0);let h=String(e||"").toLowerCase(),p="seedance-v1-5-pro"===h||h.startsWith("seedance")||h.startsWith("hailuo")||h.startsWith("vidu-q2")||h.startsWith("vidu");("T5"===m||"T6"===m)&&"video"===l&&p&&(s=0),i=`${a} ${eo("points")||"积分"}`;let x=null!==q&&s>q,f=null!==B?Math.max(B-(H||0),0):1,g="free"===n&&f<1;Q.some(e=>{let t=e.type,s=e.params,a="image_generation"===t||s?.type==="image",i="video_generation"===t||s?.type==="video";return("image"===l&&!!a||"video"===l&&!!i)&&("queued"===e.status||"submitting"===e.status||"processing"===e.status)});let v=!e.includes("image-optimization")&&(!w||!w.trim()),{allowed:b,labelSuffix:j}=o(e),y=!b||x||g||Z||ee||v,N=(0,t.jsx)(r.Button,{className:"w-full",size:"lg",disabled:y,onClick:ea,children:(0,t.jsx)("div",{className:"flex items-center gap-2",children:ee?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(et.Loader2,{className:"h-4 w-4 animate-spin"}),(0,t.jsx)("span",{children:eo("submitting")||"Submitting..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ts.Sparkles,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:eo("generate_button")||"Generate"}),(0,t.jsxs)("span",{className:"opacity-80 text-xs font-normal ml-1",children:["(",i,")"]})]})})});return!b||x||g||v?(0,t.jsx)(ty.TooltipProvider,{children:(0,t.jsxs)(ty.Tooltip,{children:[(0,t.jsx)(ty.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:"w-full cursor-not-allowed",children:N})}),(0,t.jsx)(ty.TooltipContent,{children:(0,t.jsx)("p",{children:b?v?eo("please_enter_prompt")||"请输入提示词":x?eo("insufficient_points_tip"):g?eo("tooltip_daily_limit_reached"):"超过任务并发数，请等待任务完成":`权限不足${j}`})})]})}):N})()]})}function tD(){return(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)(et.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}),children:(0,t.jsx)(tz,{})})}function tz(){let{t:e}=(0,tu.useI18n)(),{toast:l}=(0,to.useToast)(),n=(0,tm.useSearchParams)(),o=(0,tm.useRouter)();!function(){let{toast:e}=(0,to.useToast)(),t=(0,s.useRef)(!1);(0,s.useEffect)(()=>{if(t.current)return;t.current=!0;let s=setTimeout(async()=>{try{let t=(0,eW.createClient)(),{data:{session:s}}=await t.auth.getSession();if(!s?.access_token)return;let a="/api/worker",i=await fetch(`${a}/task-list`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(!i.ok)return;let r=await i.json();if(!r.success||!Array.isArray(r.tasks))return;let l=r.tasks,n=Date.now(),o=l.filter(e=>{if("running"!==e.status&&"queued"!==e.status&&"submitting"!==e.status&&"processing"!==e.status)return!1;let t=new Date(e.updated_at).getTime();return n-t>3e5});if(0===o.length)return;console.log(`[AutoRefresh] Found ${o.length} stale tasks. Triggering recovery...`),await Promise.allSettled(o.map(async e=>{await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({taskId:e.id,action:"retrieve"})})})),o.length>0&&e({title:"已自动同步任务状态",description:`检测到 ${o.length} 个卡顿任务，正在尝试恢复...`})}catch(e){console.error("[AutoRefresh] Failed to check tasks:",e)}},1e3);return()=>clearTimeout(s)},[e])}(),(0,s.useEffect)(()=>{(async()=>{let e=(0,eW.createClient)(),{data:{user:t}}=await e.auth.getUser();if(!t){let e=encodeURIComponent(window.location.pathname+window.location.search);o.replace(`/auth/login?next=${e}`)}})()},[o]);let[d,c]=(0,s.useState)("image"),u="paid",[m,h]=(0,s.useState)("");(0,s.useEffect)(()=>{let e=n.get("type"),t=n.get("model");("video"===e||"image"===e)&&c(e),t&&(h(t),t.includes("grok-imagine")&&c("video"))},[n]);let[p,x]=(0,s.useState)(""),[f,g]=(0,s.useState)(1),[v,b]=(0,s.useState)("1:1"),[w,j]=(0,s.useState)("2048*2048"),[y,N]=(0,s.useState)("5s"),[k,C]=(0,s.useState)("first_frame"),[_,S]=(0,s.useState)("720P"),[P,T]=(0,s.useState)("frames"),[L,R]=(0,s.useState)("1K"),[M,E]=(0,s.useState)("2.3"),[D,z]=(0,s.useState)("768P"),[$,I]=(0,s.useState)("720P"),[U,A]=(0,s.useState)(!1),[W,F]=(0,s.useState)(null),[O,q]=(0,s.useState)("all"),[B,H]=(0,s.useState)("lossless"),[K,V]=(0,s.useState)("1K"),{uploadedImages:G,setUploadedImages:J,isUploading:Y,allocatedSession:et,setAllocatedSession:es,handleImageUpload:ea,uploadAtIndex:ei,removeImage:er}=function({generateModel:e,mediaType:t,mode:a,wanMode:i,veoMode:r,hailuoMode:l,optMode:n}){let{toast:o}=(0,to.useToast)(),{t:d}=(0,tu.useI18n)(),[c,u]=(0,s.useState)([]),[m,h]=(0,s.useState)(!1),[p,x]=(0,s.useState)(null);(0,s.useEffect)(()=>{u(e=>(e.forEach(e=>URL.revokeObjectURL(e.url)),[]))},[t]);let f=async e=>{let t=(0,eW.createClient)(),{data:{user:s}}=await t.auth.getUser();try{let t=new FormData;t.append("file",e),s?.id&&t.append("user_id",s.id);let a=await fetch("https://upload-proxy.xiguapi.tech/v1/upload",{method:"POST",body:t});if(!a.ok){let e=await a.text();throw Error(`Upload failed: ${a.status} ${e}`)}let i=await a.json();if(!i.url)throw Error("Invalid response: URL missing");return{url:i.url,id:i.id}}catch(e){throw console.error("Upload Error:",e),e}},g=async(s,a)=>{let i,r,l,c,m=0x1400000;if("video"===t&&(m=0x1e00000),e.includes("image-optimization")&&("lossless"===n?m=3145728:"clarity"===n&&(m=7340032)),a.size>m)return void(e.includes("image-optimization")?o({title:`图片大小超过限制 (${"lossless"===n?"3MB":"7MB"})`,variant:"destructive"}):o({title:d("err_file_too_large"),variant:"destructive"}));let p=URL.createObjectURL(a);if(a.type.startsWith("video/"))try{let e=await th(p);i=e.width,r=e.height,l=e.duration,c=e.coverBlob}catch(e){console.error("Failed to get video metadata",e)}else if(a.type.startsWith("image/"))try{await new Promise((e,t)=>{let s=new Image;s.onload=()=>{i=s.width,r=s.height,e(null)},s.onerror=t,s.src=p})}catch(e){console.error("Failed to get image dimensions",e)}if(a.type.startsWith("image/")&&"number"==typeof i&&"number"==typeof r&&(i<300||r<300)){URL.revokeObjectURL(p),o({title:"图片尺寸太小 请不能小于300px",variant:"destructive"});return}let x={file:a,url:p,uploading:!0,width:i,height:r,duration:l,id:Date.now().toString()};u(e=>{let t=[...e];return t[s]&&URL.revokeObjectURL(t[s].url),t[s]=x,t}),h(!0);try{let e,{url:t,id:i}=await f(a);if(c){let t=new File([c],"cover.jpg",{type:"image/jpeg"});e=(await f(t)).url}u(a=>{let r=[...a];return r[s]&&r[s].url===p&&(r[s].remoteUrl=t,r[s].id=i,r[s].coverUrl=e,r[s].uploading=!1),r})}catch(e){console.error("Upload failed:",e),o({title:"Upload failed",variant:"destructive"}),u(e=>{let t=[...e];return t[s]&&t[s].url===p&&t.splice(s,1),t})}finally{h(!1)}},v=async e=>{let t=!1,s=(await Promise.all(e.map(async e=>{let s,a,i,r=URL.createObjectURL(e);if(e.type.startsWith("video/"))try{let e=await th(r);s=e.width,a=e.height,i=e.duration}catch(e){console.error("Failed to get video metadata",e)}else if(e.type.startsWith("image/"))try{await new Promise((e,t)=>{let i=new Image;i.onload=()=>{s=i.width,a=i.height,e(null)},i.onerror=t,i.src=r})}catch(e){console.error("Failed to get image dimensions",e)}return e.type.startsWith("image/")&&"number"==typeof s&&"number"==typeof a&&(s<300||a<300)?(t=!0,URL.revokeObjectURL(r),null):{file:e,url:r,uploading:!0,width:s,height:a,duration:i,id:Date.now().toString()+Math.random()}}))).filter(e=>null!==e);if(t&&o({title:"图片尺寸太小 请不能小于300px",variant:"destructive"}),0===s.length)return;let a=0;u(e=>(a=e.length,[...e,...s])),h(!0);try{let e=s.map(async e=>{let t;if(!e.file)return{remoteUrl:"",id:void 0,coverUrl:void 0};let{url:s,id:a}=await f(e.file);if(e.coverBlob){let s=new File([e.coverBlob],"cover.jpg",{type:"image/jpeg"});t=(await f(s)).url}return{remoteUrl:s,id:a,coverUrl:t}}),t=await Promise.all(e);u(e=>{let s=[...e];for(let e=0;e<t.length;e++){let i=a+e;s[i]&&(s[i].remoteUrl=t[e].remoteUrl,s[i].id=t[e].id,s[i].coverUrl=t[e].coverUrl,s[i].uploading=!1)}return s})}catch(e){console.error("Image upload failed:",e),u(e=>e.filter(e=>!e.uploading))}finally{h(!1)}},b=s=>{let a="image"===t?3:1;e.includes("image-optimization")?a=1:e.includes("veo3.1")?a="reference"===r?3:2:e.includes("hailuo")?a="2.3"===l?1:2:(e.includes("nanobanana")||e.includes("seedream")||e.includes("gpt-image"))&&(a=5);let i=!1,u=s.filter(s=>{let a=0x1400000;return("video"===t&&(a=0x1e00000),e.includes("image-optimization")&&("lossless"===n?a=3145728:"clarity"===n&&(a=7340032)),s.size>a)?(i=!0,!1):!c.some(e=>e.file&&e.file.size===s.size&&e.file.lastModified===s.lastModified)});i&&(e.includes("image-optimization")?o({title:`图片大小超过限制 (${"lossless"===n?"3MB":"7MB"})`,variant:"destructive"}):o({title:d("err_file_too_large"),variant:"destructive"}));let m=a-c.length;if(m<=0||0===u.length){m<=0&&o({title:"Upload Limit",description:`You can only upload up to ${a} images.`,variant:"destructive"});return}v(u.slice(0,m))},w=async e=>{let t=e.target.files;t&&(b(Array.from(t)),e.target.value="")},j=async t=>{if(e.includes("wan2.6")&&"video_ref"===i){let e=t.clipboardData?.items;if(e&&Array.from(e).some(e=>e.type.startsWith("image/")))return void o({title:d("err_operation_not_allowed"),description:d("err_wan_video_ref_paste"),variant:"destructive"})}let s=t.clipboardData?.items;if(!s)return;let a=[];for(let e=0;e<s.length;e++)if(s[e].type.startsWith("image/")){let t=s[e].getAsFile();t&&a.push(t)}0!==a.length&&b(a)};return(0,s.useEffect)(()=>{if("generate"===a)return document.addEventListener("paste",j),()=>{document.removeEventListener("paste",j)}},[a,c,t,e,p,i]),{uploadedImages:c,setUploadedImages:u,isUploading:m,allocatedSession:p,setAllocatedSession:x,handleImageUpload:w,uploadAtIndex:g,removeImage:e=>{u(t=>{let s=[...t];return URL.revokeObjectURL(s[e].url),s.splice(e,1),s})}}}({generateModel:m,mediaType:d,mode:"generate",veoMode:P,hailuoMode:M,optMode:B,wanMode:k});(0,s.useEffect)(()=>{m.includes("wan2.6")&&J([])},[k,m]),(0,s.useEffect)(()=>{if(m.includes("veo3.1")){if(m.includes("fast"))return void R(e=>"1K"===e||"4K"===e?e:"1K");R(e=>"720P"===e||"1080P"===e?e:"1080P")}},[m]),(0,s.useEffect)(()=>{(m.includes("image-optimization")||m.includes("grok-imagine"))&&G.length>1&&J(e=>e.slice(0,1))},[m,G.length,J]);let{userPoints:el,dailyLimit:en,dailyUsage:eo,userRole:ed,imageConcurrency:ec,videoConcurrency:eu,runningImageCount:em,runningVideoCount:eh,queuedImageCount:ep,queuedVideoCount:ex}=(0,tp.useUserStats)(),[ef,eg]=(0,s.useState)([]),[ev,eb]=(0,s.useState)(!1),ew=function(e,t={image:3,video:1}){let[a,i]=(0,s.useState)(null);return(0,s.useRef)(new Set),(0,s.useEffect)(()=>{let t=e.filter(e=>"queued"===e.status).sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime());if(!t[0])return void i(null);let s=(0,eW.createClient)(),a=!0,r=async()=>{if(!a||0===t.length)return;let e=t[0],r=new Date(Date.now()-3e5).toISOString(),{count:l,error:n}=await s.from("tasks_view").select("*",{count:"exact",head:!0}).eq("status","queued").lt("created_at",e.created_at).gt("created_at",r),{count:o,error:d}=await s.from("tasks_view").select("*",{count:"exact",head:!0}).eq("status","running").or("type.eq.image_generation,params->>type.eq.image"),{count:c,error:u}=await s.from("tasks_view").select("*",{count:"exact",head:!0}).eq("status","running").or("type.eq.video_generation,params->>type.eq.video"),{count:m,error:h}=await s.from("tasks_view").select("*",{count:"exact",head:!0}).eq("status","queued").gt("created_at",r);n||d||u||h||!a||i({position:(l||0)+1,total:m||0})};r();let l=setInterval(r,5e3);return()=>{a=!1,clearInterval(l)}},[e,t.image,t.video]),a}(ef,{image:ec??3,video:eu??1}),[ej,ey]=(0,s.useState)(null),eN=(0,s.useMemo)(()=>ej?ef.find(e=>e.id===ej)||null:ef.length>0?ef[0]:null,[ef,ej]),ek=(0,s.useMemo)(()=>(eN?.result?.images||[]).map(e=>td(e)),[eN]),[eC,e_]=(0,s.useState)(0),[eS,eP]=(0,s.useState)(!1);!function(e,t,a){let{t:i}=(0,tu.useI18n)(),{toast:r}=(0,to.useToast)();(0,s.useEffect)(()=>{let s=e.filter(e=>"running"===e.status||"queued"===e.status||"submitting"===e.status||"processing"===e.status);if(0===s.length)return void a(!1);a(!0);let l=(0,eW.createClient)(),n=setInterval(async()=>{let{data:{session:a}}=await l.auth.getSession(),n=a?.access_token,o="id, status, result, created_at, started_at, type, params",d=null,c=null,u=await l.from("tasks_view").select(`${o}, updated_at`).in("id",s.map(e=>e.id));if(d=u.data,(c=u.error)&&c.message&&c.message.includes("updated_at")){let e=await l.from("tasks_view").select(o).in("id",s.map(e=>e.id));d=e.data,c=e.error}if(c)return void console.error("[Polling] DB Error:",c);if(d){let a=!1,l=[...e];for(let e of d){let t=l.findIndex(t=>t.id===e.id);if(-1!==t){let s=l[t];e.result,s.result;let n=JSON.stringify(s.result)!==JSON.stringify(e.result);if(s.status!==e.status||n){if(l[t]={...s,...e},a=!0,"success"===e.status)window.dispatchEvent(new Event("daily_usage:updated"));else if("running"===e.status||"submitting"===e.status||"processing"===e.status)window.dispatchEvent(new Event("daily_usage:updated"));else if("failed"===e.status){window.dispatchEvent(new Event("daily_usage:updated"));let t=e.result?.error||"Task failed";r({title:"string"==typeof t&&(t.includes("IMAGE_PROHIBITED_CONTENT")||t.includes("Content policy violation"))?"生成图像违反规定，请修改提示词":i("generation_failed")||"Generation failed",description:void 0,variant:"destructive"})}}}if("running"===e.status||"queued"===e.status||"submitting"===e.status||"processing"===e.status){let t=s.find(t=>t.id===e.id);if(t){let s="running"===e.status&&e.started_at?new Date(e.started_at).getTime():new Date(t.created_at).getTime(),a=e.updated_at?new Date(e.updated_at).getTime():new Date(t.created_at).getTime(),i=Date.now()-s,r=Date.now()-a,l="video_generation"===e.type||"video_generator"===e.type||e.params?.type==="video"?12e4:3e4,o="running"===e.status&&i>l,d=("queued"===e.status||"submitting"===e.status||"processing"===e.status)&&r>3e4;(o||d)&&fetch("/api/worker",{method:"POST",headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{}},body:JSON.stringify({taskId:e.id})}).then(e=>e.json()).then(e=>{}).catch(e=>console.error("Poll failed:",e))}}}a&&t(l)}},5e3);return()=>{clearInterval(n)}},[e])}(ef,eg,eP);let[eT,eL]=(0,s.useState)(!1),eR=(0,s.useRef)(!1),[eM,eD]=(0,s.useState)(!1),[ez,e$]=(0,s.useState)(!1),[eF,eO]=(0,s.useState)([]),[eB,eH]=(0,s.useState)("v7"),[eK,eV]=(0,s.useState)("normal"),[eG,eX]=(0,s.useState)("fast"),[eJ,eY]=(0,s.useState)("normal"),[eQ,eZ]=(0,s.useState)("360P"),[e0,e1]=(0,s.useState)({}),[e2,e3]=(0,s.useState)("auto"),{handleSaveTask:e4,handleApplyHistoryTask:e5,handleApplyParams:e8}=function(e){let{toast:t}=(0,to.useToast)(),{t:s}=(0,tu.useI18n)(),{setTasks:a,setIsSaving:i,setMediaType:r,setGenerateModel:l,setPrompt:n,setAspectRatio:o,setResolution:d,setDuration:c,setUploadedImages:u,setVeoMode:m,setGrokMode:h,setGrokResolution:p,setHailuoMode:x,setHailuoResolution:f,setQuality:g,setInfoDialogOpen:v,setHistoryDialogOpen:b}=e,w=e=>{if(!e?.params)return;let t=e.params,s="image";"video_generation"===e.type||"video_generator"===e.type?s="video":t.model&&(t.model.includes("veo")||t.model.includes("sora")||t.model.includes("grok-imagine"))&&(s="video"),r(s),t.model&&l(t.model),t.prompt&&n(t.prompt),t.ratio&&o(t.ratio),t.resolution&&d(t.resolution),setTimeout(()=>{let e=t.images||t.imageUrls||[];Array.isArray(e)&&e.length>0?u(e.map((e,t)=>{let s="string"==typeof e?e:e.url;return s&&!s.startsWith("http")&&(s=`https://${s}`),{file:null,preview:s,url:s,id:Date.now().toString()+t,width:"object"==typeof e?e.width:void 0,height:"object"==typeof e?e.height:void 0}})):u([])},100),t.duration&&c(t.duration),t.veoMode&&m(t.veoMode),t.model_version&&x?x("2.6"===t.model_version?"2.3":t.model_version):t.hailuoMode&&x&&x("2.6"===t.hailuoMode?"2.3":t.hailuoMode),t.hailuoResolution&&f&&f(t.hailuoResolution),t.grokMode&&h(t.grokMode),t.grokResolution&&p(t.grokResolution),t.quality&&g&&g(t.quality)};return{handleSaveTask:async e=>{if(("success"===e.status||"saved"===e.status)&&"saved"!==e.status){i(!0);try{let i=await fetch("/api/tasks/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:e.id})});if(i.ok)a(t=>t.map(t=>t.id===e.id?{...t,status:"saved"}:t)),t({title:s("tooltip_favorite_saved")});else{let e=await i.json();console.error("Failed to save task:",e.error),t({title:s("err_save_failed"),variant:"destructive"})}}catch(e){console.error(e),t({title:s("err_save_failed"),variant:"destructive"})}finally{i(!1)}}},handleApplyHistoryTask:e=>{w(e),b(!1),t({title:"已应用历史参数"})},handleApplyParams:e=>{e&&(w(e),v(!1),t({title:"已应用原始参数"}))}}}({setTasks:eg,setIsSaving:eb,setMediaType:c,setGenerateModel:h,setPrompt:x,setAspectRatio:b,setResolution:j,setDuration:N,setUploadedImages:J,setVeoMode:T,setGrokMode:eY,setGrokResolution:eZ,setHailuoMode:E,setHailuoResolution:z,setInfoDialogOpen:eD,setHistoryDialogOpen:e$,setQuality:e3});(0,s.useEffect)(()=>{(async()=>{let e=(0,eW.createClient)(),{data:t,error:s}=await e.rpc("get_app_config_list");if(s)return console.error("Failed to fetch app config:",s);let a={};t&&t.forEach(e=>{a[e.type]=Number(e.points)}),console.log("[Pricing] Loaded pricing map:",a),e1(a)})()},[]),(0,s.useEffect)(()=>{(async()=>{let e=(0,eW.createClient)(),{data:{user:t}}=await e.auth.getUser();if(!t)return;let{data:s,error:a}=await e.from("tasks_view").select("*").eq("user_id",t.id).gte("created_at",new Date(Date.now()-1728e5).toISOString()).order("created_at",{ascending:!1}).limit(40);if(s){let e=s.filter(e=>!e.result?.images?.includes("delete")).slice(0,20);eg(e),e.length>0&&ey(e[0].id)}})()},[]);let e6=(0,s.useMemo)(()=>m.includes("veo")||m.includes("sora-2")?["16:9","9:16"]:m.includes("hailuo")?[]:m.includes("z-image")?["1:1","4:3","3:4","16:9","9:16"]:m.includes("gpt-image-v1-5")?["1:1","2:3","3:2"]:m.includes("seedance")?["16:9","4:3","1:1","3:4","9:16","21:9"]:m.includes("google-nanobananapro")||m.includes("nanobanana")?["1:1","2:3","3:2","3:4","4:3","4:5","5:4","9:16","16:9","21:9"]:m.includes("wan2.6")?["16:9","9:16","1:1","4:3","3:4"]:["1:1","2:3","3:2","3:4","4:3","4:5","5:4","9:16","16:9","21:9"],[m]);(0,s.useEffect)(()=>{e6.length>0&&!e6.includes(v)&&b(e6[0])},[e6,v]),(0,s.useEffect)(()=>{if(m.includes("sora-2")&&"10s"!==y&&"15s"!==y&&N("10s"),m.includes("seedance")){let e="1080P"===$;(e?["4s","8s"]:["4s","8s","12s"]).includes(y)||N("4s"),"720P"!==$&&"1080P"!==$&&I("720P"),e&&"12s"===y&&N("8s")}m.includes("hailuo")&&("6s"!==y&&N("6s"),"1080P"!==D&&"768P"!==D&&z("768P"),""!==v&&b("")),m.includes("vidu-q2")&&("4s"!==y&&"8s"!==y&&N("4s"),"1080P"!==D&&"720P"!==D&&z("720P")),m.includes("veo3.1")&&("4s"!==y&&"8s"!==y&&N("4s"),"16:9"!==v&&"9:16"!==v&&b("16:9"),m.includes("fast")?"1K"!==L&&"4K"!==L&&R("1K"):"1080P"!==L&&"720P"!==L&&R("1080P"))},[m,y,D,L,$]);let e7=(0,s.useMemo)(()=>[1,2,3,4],[]);(0,s.useEffect)(()=>{e7.includes(f)||g(e7[0])},[e7,f]),(0,s.useEffect)(()=>{if(!m)return;m.includes("wan2.6")?N("5s"):m.includes("veo")?m.includes("fast")?N("8s"):N("4s"):m.includes("seedance")?(N("4s"),I("720P")):m.includes("sora-2")?N("10s"):m.includes("hailuo")?N("6s"):m.includes("vidu-q2")?N("4s"):m.includes("grok-imagine")&&N("5s"),m.includes("veo")||m.includes("hailuo")||m.includes("sora-2")||m.includes("wan2.6")?b("16:9"):(m.includes("z-image")||m.includes("gpt-image"),b("1:1")),m.includes("hailuo")?("first_last_frame"===O?E("02"):E("2.3"),z("768P")):m.includes("veo")?("reference_image"===O?T("reference"):T("frames"),R(m.includes("fast")?"1K":"1080P")):m.includes("wan2.6")?("theme_library"===O?C("video_ref"):C("first_frame"),S("720P"),N("5s")):m.includes("grok-imagine")?(eY("normal"),eZ("360P")):m.includes("midjourney")&&(eV("normal"),eX("fast"),eH("v7")),"video"===d&&g(1),m.includes("image-optimization")&&g(1);let e=a.models.find(e=>e.id===m);e?e.inputSupported.includes("image")||J([]):m.includes("z-image")&&J([])},[d,m,J,O]);let e9=(0,s.useMemo)(()=>a.models.filter(e=>e.output===d),[d]),te="google-nanobananapro"===m||"google-nanobananapro-2k"===m||"google-nanobananapro-4k"===m;(0,s.useMemo)(()=>te?m.includes("4k")?"4K":m.includes("2k")?"2K":"1K":null,[m,te]);let tt=e=>({allowed:!0,labelSuffix:""});(0,s.useEffect)(()=>{if(e9.length>0){let e=e9.find(e=>e.id===m),{allowed:t}=tt(m);if(!e||!t){if("video"===d){let e=e9.find(e=>"sora-2"===e.id);if(e&&tt(e.id).allowed)return void h(e.id)}let e=e9.find(e=>tt(e.id).allowed);e?(h(e.id),e.id.includes("veo")&&b("16:9")):(h(e9[0].id),e9[0].id.includes("veo")&&b("16:9"))}}else h("")},[d,u,e9,m,ed]);let ts=async()=>{if(Y)return void l({title:"请稍候",description:"图片正在上传中...",variant:"destructive"});if(G.some(e=>!e.remoteUrl&&e.url.startsWith("blob:")))return void l({title:"错误",description:"部分图片上传失败，请删除后重试。",variant:"destructive"});if(eR.current)return;if(m.includes("veo3.1-fast")){let e=G[0];if(G[1]&&!e)return void l({title:"验证错误",description:"如果有结束帧，必须要有起始帧。",variant:"destructive"})}if(m.includes("google-nanobananapro")){let e=(p||"").trim();if(e.includes("去水印")||e.includes("去掉水印"))return void l({title:"提示词包含去水印内容",description:"nanobananapro 不是去水印模型",variant:"destructive"})}if(!p.trim()&&0===G.length)return;let t=!1;eR.current=!0,eL(!0),eP(!0);try{let s=(0,eW.createClient)(),{data:{user:i}}=await s.auth.getUser();if(!i){l({title:"Unauthorized",description:"Please sign in.",variant:"destructive"}),eP(!1);return}e_(0);let r=G.filter(e=>e.remoteUrl||e.url).map(e=>{let t=e.remoteUrl||e.url;t&&!t.startsWith("http")&&(t=`https://${t}`);try{t=encodeURI(t)}catch(e){console.error("Failed to encode URL:",t)}return{url:t,width:e.width||1024,height:e.height||1024,duration:e.duration,cover:e.preview,uploadId:e.id}}),n=r.map(e=>e.url);for(let i=0;i<f;i++)try{let o=0,c=e0[m];void 0===c&&"wan2.6"===m&&(c=e0["wan2.6"],void 0===c&&(c=15)),void 0===c&&m.includes("seedance")&&(c=80),void 0===c&&m.includes("veo3.1")&&!m.includes("fast")&&(c="veo3.1"===m?150:100),o=void 0!==c?c:1,m.includes("wan2.6")&&("10s"===y&&(o*=2),"1080P"===_&&(o*=2)),m.includes("seedance")&&("8s"===y&&(o*=2),"12s"===y&&(o*=3),"1080P"===$&&(o*=2)),m.includes("grok-imagine")&&"720P"===eQ&&(o=Math.ceil(1.5*o)),m.includes("hailuo")&&"768P"===D&&(o=Math.ceil(.6*o)),m.includes("vidu-q2")&&("720P"===D&&(o=Math.ceil(.6*o)),"8s"===y&&(o*=2)),m.includes("veo3.1")&&!m.includes("fast")&&"8s"===y&&(o*=2),m.includes("veo3.1-fast")&&"4K"===String(L||"").toUpperCase()&&(o=Math.ceil(1.5*o));let u=(ed||"").toUpperCase();("T4"===u||"T6"===u)&&"image"===d&&(o=0);let h=String(m||"").toLowerCase(),x="seedance-v1-5-pro"===h||h.startsWith("seedance")||h.startsWith("hailuo")||h.startsWith("vidu-q2")||h.startsWith("vidu");if(("T5"===u||"T6"===u)&&"video"===d&&x&&(o=0),o>0&&(el||0)<o){i>0&&l({title:"Insufficient points",variant:"destructive"});break}let f="/api/worker",{data:{session:g}}=await s.auth.getSession(),b=g?.access_token,j=null;try{let t=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({params:{prompt:p,model:m,ratio:m.includes("hailuo")?void 0:v,resolution:m.includes("hailuo")||m.includes("vidu-q2")?D:m.includes("seedance")?$:m.includes("veo3.1")?L:m.includes("google-nanobananapro")?m.includes("4k")?"4K":m.includes("2k")?"2K":"1K":w,imageUrls:!m.includes("z-image")&&(a.models.find(e=>e.id===m)?.inputSupported.includes("image")??!0)?n:void 0,images:!m.includes("z-image")&&(a.models.find(e=>e.id===m)?.inputSupported.includes("image")??!0)?r:void 0,cost:o,mjModel:"midjourney"===m?eB:void 0,mjMode:"midjourney"===m?eK:void 0,mjSpeed:"midjourney"===m?eG:void 0,duration:"video"===d?y:void 0,wanMode:m.includes("wan2.6")?k:void 0,wanResolution:m.includes("wan2.6")?_:void 0,veoMode:m.includes("veo3.1")?P:void 0,hailuoMode:m.includes("hailuo")?M:void 0,grokMode:m.includes("grok-imagine")?eJ:void 0,grokResolution:m.includes("grok-imagine")?eQ:void 0,optMode:m.includes("image-optimization")?B:void 0,type:"video"===d?"video_generation":"image_generation"}})});if(!t.ok){let s=await t.json().catch(()=>({}));429===t.status?l({title:e("err_too_many_tasks"),variant:"destructive"}):l({title:"Failed to create task",description:s.error||s.message||"Unknown error",variant:"destructive"});continue}let s=await t.json();if(!s.success||!s.task){console.error("Task creation failed (invalid response):",s);continue}j=s.task}catch(e){console.error("Worker request failed:",e),l({title:"Network error",variant:"destructive"});continue}if(!j)continue;eg(e=>[j,...e].slice(0,10)),ey(j.id),t=!0,"queued"===j.status&&fetch(f,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({taskId:j.id})}).catch(e=>console.error("Failed to trigger worker execution:",e)),await new Promise(e=>setTimeout(e,200))}catch(e){console.error("Error in generation loop:",e)}}catch(e){console.error("Error in handleGenerate:",e)}finally{t||eP(!1),eR.current=!1,eL(!1)}},ta=ek.length>0?ek[eC]:null,ti=async()=>{if(ta)try{var e;let t,s,a=await fetch(ta,{mode:"cors",cache:"no-store",headers:{"Access-Control-Request-Method":"GET"}});if(!a.ok)throw Error(`Fetch failed: ${a.status}`);e=await a.blob(),t=window.URL.createObjectURL(e),(s=document.createElement("a")).href=t,s.download=`generated-${Date.now()}.png`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(t),document.body.removeChild(s),l({title:"下载成功"})}catch(e){console.error("Direct download failed:",e),window.open(ta,"_blank"),l({title:"自动下载失败",description:"已在新窗口打开，请右键另存为",variant:"destructive"})}};return(0,t.jsxs)("div",{className:"flex h-full w-full overflow-hidden",children:[ta&&(0,t.jsx)(eq.Dialog,{open:U,onOpenChange:A,children:(0,t.jsxs)(eq.DialogContent,{className:"max-w-[95vw] w-full h-[95vh] p-0 border-0 bg-transparent shadow-none flex items-center justify-center outline-none",showCloseButton:!1,children:[(0,t.jsx)(eq.DialogTitle,{className:"hidden",children:"Preview"}),(0,t.jsx)(eq.DialogDescription,{className:"hidden",children:"Image Preview"}),(0,t.jsx)("div",{className:"relative w-full h-full flex items-center justify-center",onClick:()=>A(!1),children:(0,t.jsx)("img",{src:ta,referrerPolicy:"no-referrer",alt:"Full preview",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",onClick:e=>e.stopPropagation()})})]})}),(0,t.jsxs)("div",{className:"w-[460px] border-r bg-muted/10 flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"px-4 py-2 bg-background/50 backdrop-blur-sm flex-shrink-0 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"font-semibold text-lg",children:"Generate"}),(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsxs)(r.Button,{variant:"image"===d?"default":"ghost",size:"sm",onClick:()=>c("image"),className:"h-7 px-2 text-xs",children:[(0,t.jsx)(Q,{className:"h-3 w-3 mr-1"}),e("image")]}),(0,t.jsxs)(r.Button,{variant:"video"===d?"default":"ghost",size:"sm",onClick:()=>c("video"),className:"h-7 px-2 text-xs",children:[(0,t.jsx)(Z.Video,{className:"h-3 w-3 mr-1"}),e("video")]})]})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:[(0,t.jsx)(X,{className:"flex-shrink-0 max-h-[50%]",children:(0,t.jsxs)("div",{className:"px-4 pt-1 pb-3 space-y-4",children:[(0,t.jsx)(tP,{mediaType:d,setMediaType:c,modelPricing:u,generateModel:m,setGenerateModel:h,availableModels:e9,checkModelAccess:tt,wanMode:k,setWanMode:C,veoMode:P,setVeoMode:T,hailuoMode:M,setHailuoMode:E,setAspectRatio:b,setDuration:N,setGrokMode:eY,videoFilter:O,setVideoFilter:q}),!m.includes("z-image")&&(0,t.jsx)(tL,{generateModel:m,mediaType:d,wanMode:k,veoMode:P,hailuoMode:M,optMode:B,uploadedImages:G,handleImageUpload:ea,uploadAtIndex:ei,removeImage:er,setLightboxImage:F,setLightboxOpen:A})]})}),!m.includes("image-optimization")&&(0,t.jsx)(t_,{prompt:p,setPrompt:x,generateModel:m})]}),(0,t.jsx)(tE,{generateModel:m,setGenerateModel:h,mediaType:d,modelPricing:u,checkModelAccess:tt,userRole:ed||"T0",grokResolution:eQ,setGrokResolution:eZ,grokMode:eJ,setGrokMode:eY,quality:e2,setQuality:e3,optMode:B,setOptMode:H,prompt:p,mjModel:eB,setMjModel:eH,mjMode:eK,setMjMode:eV,mjSpeed:eG,setMjSpeed:eX,hailuoMode:M,setHailuoMode:E,hailuoResolution:D,setHailuoResolution:z,seedanceResolution:$,setSeedanceResolution:I,veoResolution:L,setVeoResolution:R,aspectRatio:v,setAspectRatio:b,duration:y,setDuration:N,count:f,setCount:g,aspectRatios:e6,pricingMap:e0,userPoints:el,dailyLimit:en,dailyUsage:eo,imageConcurrency:ec,videoConcurrency:eu,runningImageCount:em,runningVideoCount:eh,queuedImageCount:ep,queuedVideoCount:ex,tasks:ef,isUploading:Y,isSubmitting:eT,isGenerating:eS,handleGenerate:ts,wanMode:k,setWanMode:C,wanResolution:_,setWanResolution:S,resolution:K,setResolution:V})]}),(0,t.jsxs)("div",{className:"flex-1 bg-background flex flex-col relative overflow-hidden",children:[(0,t.jsx)("div",{className:"absolute top-3 left-4 z-30",children:(0,t.jsx)("div",{className:"flex flex-col justify-center gap-1 px-3 py-2 bg-background/80 backdrop-blur-sm border rounded-xl shadow-sm hover:bg-background transition-colors cursor-default min-w-[140px]",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("img",{src:"/icons/points.svg",alt:"credits",className:"h-3 w-3 dark:invert"}),(0,t.jsx)("span",{className:"text-xs font-medium",children:null!==el?el.toFixed(2):"..."})]})})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-muted/5 pattern-grid-lg opacity-50 pointer-events-none"}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-between p-4 pt-12 gap-4 relative z-10 overflow-hidden",children:[(0,t.jsx)(tN,{activeTask:eN,queueState:ew,generatedImages:ek,selectedImageIndex:eC,setSelectedImageIndex:e_,setLightboxOpen:A,isSaving:ev,onSaveTask:e4,onUseAsReference:()=>{if(ta){if(m.includes("wan2.6")&&"video_ref"===k&&!ta.toLowerCase().match(/\.(mp4|mov|webm|avi|mkv)(\?|$)/i))return void l({title:e("err_operation_not_allowed"),description:e("err_wan_video_ref_paste"),variant:"destructive"});J([{file:null,preview:ta,url:ta,id:Date.now().toString()}]),l({title:"已设置为参考图"})}},onDownloadImage:ti,onOpenInfoDialog:eD,mediaType:d}),(0,t.jsx)(tf,{tasks:ef,activeTaskId:ej,onSelectTask:ey,onImageSelect:e_})]}),(0,t.jsx)("div",{className:"flex-shrink-0 w-full pb-6 pt-2 z-50 flex justify-center",children:(0,t.jsx)(eE,{items:[{title:e("dock_history"),icon:(0,t.jsx)(eI,{className:"h-full w-full text-neutral-500 dark:text-neutral-300"}),href:"#",onClick:()=>e$(!0)},{title:null!==el?el.toFixed(2):"...",icon:(0,t.jsx)("img",{src:"/icons/points.svg",alt:"balance",className:"h-full w-full dark:invert"}),href:"/coming-soon"},{title:e("dock_records"),icon:(0,t.jsx)(eU,{className:"h-full w-full text-neutral-500 dark:text-neutral-300"}),href:"/settings/usage"},{title:e("dock_recharge"),icon:(0,t.jsx)(eA,{className:"h-full w-full text-neutral-500 dark:text-neutral-300"}),href:"/settings/credits"}]})}),(0,t.jsx)(eq.Dialog,{open:eM,onOpenChange:eD,children:(0,t.jsxs)(eq.DialogContent,{className:"max-w-2xl",children:[(0,t.jsxs)(eq.DialogHeader,{children:[(0,t.jsx)(eq.DialogTitle,{children:"原始任务信息"}),(0,t.jsx)(eq.DialogDescription,{children:"查看并重新应用该任务的原始参数"})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{children:"模型 (Model)"}),(0,t.jsx)("div",{className:"p-2 border rounded-md bg-muted text-sm font-mono",children:eN?.params?.model||"N/A"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{children:"比例 (Ratio)"}),(0,t.jsx)("div",{className:"p-2 border rounded-md bg-muted text-sm font-mono",children:eN?.params?.ratio||"N/A"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{children:"提示词 (Prompt)"}),(0,t.jsx)("div",{className:"p-2 border rounded-md bg-muted text-sm max-h-[100px] overflow-y-auto whitespace-pre-wrap",children:eN?.params?.prompt||"N/A"})]}),(eN?.params?.images?.length>0||eN?.params?.imageUrls?.length>0)&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{children:"原始参考图"}),(0,t.jsx)("div",{className:"flex gap-2 overflow-x-auto p-2 border rounded-md bg-muted/20",children:(eN?.params?.images||eN?.params?.imageUrls||[]).map((e,s)=>{let a="string"==typeof e?e:e.url;return a&&!a.startsWith("http")&&(a=`https://${a}`),(0,t.jsx)("div",{className:"relative h-20 w-20 flex-shrink-0 rounded-md overflow-hidden border",children:(0,t.jsx)("img",{src:a,alt:"Ref",className:"h-full w-full object-cover"})},s)})})]})]}),(0,t.jsxs)(eq.DialogFooter,{children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>eD(!1),children:"取消"}),(0,t.jsx)(r.Button,{onClick:()=>e8(eN),children:"填入参数 (Apply)"})]})]})}),(0,t.jsx)(tc,{open:ez,onOpenChange:e$,onApplyTask:e5}),(0,t.jsx)(eq.Dialog,{open:U&&!!W,onOpenChange:e=>{e||(A(!1),F(null))},children:(0,t.jsxs)(eq.DialogContent,{className:"max-w-[90vw] max-h-[90vh] p-0 bg-transparent border-none shadow-none flex items-center justify-center",children:[(0,t.jsx)(eq.DialogTitle,{className:"sr-only",children:"Image Preview"}),(0,t.jsx)(eq.DialogDescription,{className:"sr-only",children:"Image Preview"}),(0,t.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center",children:[W&&(0,t.jsx)("img",{src:W,alt:"Preview",className:"max-w-full max-h-[85vh] object-contain rounded-md shadow-2xl"}),(0,t.jsx)("button",{onClick:()=>A(!1),className:"absolute -top-4 -right-4 bg-white/20 hover:bg-white/40 text-white rounded-full p-2 backdrop-blur-md transition-all",children:(0,t.jsx)(ee.X,{className:"w-6 h-6"})})]})]})})]})]})}e.s(["default",()=>tD],61080)}]);