# 系统功能升级计划：定价、统计与充值

## 1. 动态定价与积分机制
- **数据库变更**:
  - 创建 `system_configs` 表，用于存储系统级键值对配置（如积分定价）。
  - 为 `generations` 表添加 `api_cost` 字段，记录每次生成的实际法币成本（USD）。
- **后端 (`worker/src/routes/generation.ts`)**:
  - 升级积分计算逻辑：从 `system_configs` 读取 1K/2K/4K 的积分价格（默认 2/4/6）。
  - 生成完成后，根据模型和分辨率记录 `api_cost`（Gemini 3 Pro: 1K/2K=$0.05, 4K=$0.10）。
- **管理员接口 (`worker/src/routes/admin.ts`)**:
  - 新增配置接口：`GET/POST /api/admin/config`，管理定价参数。

## 2. 财务统计系统
- **管理员接口 (`worker/src/routes/admin.ts`)**:
  - 升级 `GET /api/admin/stats` 接口，增加：
    - **总收入**: 统计 `orders` 表中已支付金额。
    - **总成本**: 统计 `generations` 表中 `api_cost` 总和。
    - **毛利润**: 总收入 - 总成本 (需考虑汇率，这里暂按 1 USD ≈ 7.2 CNY 估算或仅展示原始数值)。
- **前端 (`frontend/src/pages/Admin.tsx`)**:
  - 新增“财务看板”模块，可视化展示收入、成本和利润。
  - 新增“定价管理”模块，允许管理员在线调整不同分辨率的积分价格。

## 3. 充值套餐优化
- **前端 (`frontend/src/components/RechargeModal.tsx`)**:
  - 移除自定义金额输入，改为固定的套餐选择按钮。
  - **套餐配置**:
    - 6元 (60积分)
    - 10元 (100积分)
    - 30元 (330积分) - *赠送30积分*
    - 50元 (600积分) - *赠送100积分*
    - 100元 (1200积分) - *赠送200积分*
- **后端 (`worker/src/routes/payment.ts`)**:
  - 修改订单创建逻辑：不再简单按 1:10 计算积分。
  - 增加赠送逻辑判断：根据充值金额区间自动计算应得积分（含赠送部分）。

## 执行步骤
1.  **数据库**: 执行 SQL 迁移（建表 `system_configs`，改表 `generations`）。
2.  **后端**: 实现定价配置存储、成本记录、统计接口、充值赠送逻辑。
3.  **前端**: 改造充值弹窗，增加管理员定价和统计面板。
