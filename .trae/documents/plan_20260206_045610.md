# 留言板功能开发计划 (Message Board Feature Plan)

## 1. 需求分析
用户需要一个类似贴吧的“留言板”功能：
*   **发布留言**: 任何登录用户可以发布新主题（Title + Content）。
*   **回复留言**: 用户和管理员可以在主题下回复。
*   **管理员功能**: 管理员可以回复、删除留言/回复。
*   **展示形式**: 列表展示主题，点击进入详情页查看对话流。

## 2. 数据库设计 (Database Schema)
需要创建新的 Migration 文件 `0003_message_board.sql`，包含两张表：
*   `messages` (留言主题表):
    *   `id` (PK)
    *   `user_id` (FK -> users.id)
    *   `title` (标题)
    *   `content` (内容)
    *   `created_at`
    *   `updated_at`
*   `replies` (回复表):
    *   `id` (PK)
    *   `message_id` (FK -> messages.id)
    *   `user_id` (FK -> users.id)
    *   `content` (内容)
    *   `is_admin_reply` (标识是否为管理员回复)
    *   `created_at`

## 3. 后端开发 (Backend - Worker)
*   **路由文件**: 新建 `worker/src/routes/message.ts`。
*   **API 接口**:
    *   `GET /api/messages`: 获取留言列表 (分页)。
    *   `POST /api/messages`: 发布新留言。
    *   `GET /api/messages/:id`: 获取单条留言详情及其回复。
    *   `POST /api/messages/:id/reply`: 回复某条留言。
    *   `DELETE /api/messages/:id`: 删除留言 (仅管理员或作者)。
    *   `DELETE /api/replies/:id`: 删除回复 (仅管理员或作者)。
*   **注册路由**: 在 `worker/src/index.ts` 中挂载 `/api/messages`。

## 4. 前端开发 (Frontend)
*   **新页面**: `frontend/src/pages/MessageBoard.tsx`。
*   **路由配置**: 在 `App.tsx` 中添加 `/messages` 路由。
*   **入口**: 在 `Header.tsx` 导航栏增加“留言板”链接。
*   **UI 组件**:
    *   留言列表页: 展示标题、作者、时间、回复数。
    *   留言详情页 (或 Modal): 展示主楼及楼层回复。
    *   发布/回复输入框。

## 5. 实施步骤
1.  **数据库**: 创建并应用 SQL Migration。
2.  **后端**: 实现 `message.ts` 路由逻辑并挂载。
3.  **前端**: 创建页面组件并配置路由。
4.  **联调**: 验证发布、回复、删除流程。
