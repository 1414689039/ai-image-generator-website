# Gallery 页面无限滚动分页功能实现计划

用户希望移除画廊的显示数量上限，并实现分页加载（每页 20 条）。为了提供最佳的用户体验，我将把现有的固定列表改为**无限滚动（Infinite Scroll）**模式。

## 1. 前端改造 (`frontend/src/pages/Gallery.tsx`)

### 状态管理更新
- 新增 `page` 状态：记录当前页码，初始为 1。
- 新增 `hasMore` 状态：标记是否还有更多数据可加载。
- 新增 `isFetching` 状态：防止滚动时重复触发请求。

### 核心逻辑修改
1.  **重构 `fetchItems`**：
    -   接受 `pageNum` 参数。
    -   不再硬编码 `page=1`，而是使用传入的参数。
    -   数据处理逻辑分叉：
        -   如果是第 1 页：**覆盖**现有列表 (`setItems(newItems)`)。
        -   如果是后续页：**追加**到现有列表 (`setItems(prev => [...prev, ...newItems])`)。
    -   根据返回数据量判断 `hasMore`（如果返回条数 < 20，则标记为无更多数据）。

2.  **Tab 切换逻辑**：
    -   当 `activeTab` 改变时，重置所有状态（`page=1`, `items=[]`, `hasMore=true`）并立即请求第一页数据。

3.  **滚动监听实现**：
    -   使用 `IntersectionObserver` API 监听列表底部的“哨兵元素”。
    -   当用户滚动到底部看到哨兵元素时，自动触发加载下一页。
    -   作为后备，也会保留一个显式的“加载更多”按钮（当自动加载失败或为了更好的可访问性）。

### UI 调整
- 在瀑布流列表底部添加加载状态指示器：
    -   加载中：显示 Spinner。
    -   没有更多数据：显示“已经到底啦”提示。
    -   加载失败：显示重试按钮。

## 2. 验证计划
- 验证 Tab 切换时列表是否正确重置并加载第一页。
- 验证向下滚动时是否会自动加载下一页数据。
- 验证数据是否正确追加，而不是被覆盖。
- 验证当所有数据加载完毕后，是否不再触发请求并显示结束提示。
