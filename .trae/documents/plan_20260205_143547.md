# 生图灵感社区模块需求文档 (PRD)

## 1. 项目背景
构建一个类似社区的“生图灵感”模块，允许用户分享自己的生图作品。旨在促进用户互动，增加平台活跃度，并通过“付费获取同款”机制激励优质内容创作。

## 2. 功能需求

### 2.1 作品分享 (发布端)
- **入口**：在“我的生图历史”列表中，为每条记录增加“分享”按钮。
- **分享设置**：
    - **免费分享**：其他用户可免费查看提示词并做同款。
    - **付费分享**：设置固定价格（1积分）。其他用户需支付1积分才可获取同款配置。
- **状态反馈**：分享成功后，历史记录显示“已分享”标记。

### 2.2 灵感画廊 (展示端)
- **展示形式**：采用瀑布流或网格布局展示所有公开的生图作品。
- **卡片内容**：图片缩略图、作者昵称、点赞数、付费/免费标识。
- **交互**：
    - 点击图片可查看大图及详细信息。
    - 支持点赞/取消点赞。

### 2.3 做同款 (消费端)
- **核心功能**：详情页提供“去做同款”按钮。
- **免费作品**：点击按钮直接跳转至生图页面，自动填充原图的提示词、模型参数、尺寸等配置。
- **付费作品**：
    - **未解锁**：点击按钮弹出支付确认弹窗（提示“此灵感需支付1积分”）。
    - **支付流程**：确认支付 -> 扣除用户积分 -> (可选：增加作者积分) -> 记录解锁状态 -> 跳转生图页面并填充参数。
    - **已解锁**：再次点击直接跳转，无需重复支付。

## 3. 技术实施方案

### 3.1 数据库设计 (D1)
需要修改/新增以下表结构：
1.  **修改 `generations` 表**：
    - `is_public` (INT): 0=私有, 1=公开
    - `price` (DECIMAL): 分享价格 (0或1)
    - `likes_count` (INT): 点赞计数
    - `shared_at` (DATETIME): 分享时间
2.  **新增 `gallery_unlocks` 表**：记录用户解锁记录，防止重复扣费。
    - `user_id`, `generation_id`, `created_at`
3.  **新增 `gallery_likes` 表**：记录用户点赞状态。

### 3.2 后端接口 (Worker)
- `POST /api/gallery/share`: 分享作品 (参数: generationId, price)。
- `GET /api/gallery/list`: 获取灵感列表 (支持分页, 排序)。
- `GET /api/gallery/:id`: 获取详情 (包含是否已解锁状态)。
- `POST /api/gallery/unlock`: 支付解锁 (事务处理：扣分+记录)。
- `POST /api/gallery/like`: 点赞操作。

### 3.3 前端开发 (React)
1.  **页面开发**：
    - 新增 `src/pages/Gallery.tsx`: 灵感广场主页。
    - 新增 `src/components/GalleryItem.tsx`: 单个作品卡片。
    - 新增 `src/components/ImageDetailModal.tsx`: 图片详情与做同款交互弹窗。
2.  **路由配置**：在 `App.tsx` 添加 `/gallery` 路由。
3.  **状态管理**：
    - 历史记录页增加分享交互。
    - 生图页 (`Home.tsx`) 支持接收 URL 参数或 State 自动填充提示词。

## 4. 验收标准
1. 用户能成功将自己的画作分享到广场。
2. 广场能正常加载图片流。
3. 免费作品点击“做同款”能准确跳转并回填参数。
4. 付费作品点击时提示支付，支付后扣除积分并跳转回填。
5. 已解锁的作品不再提示支付。
