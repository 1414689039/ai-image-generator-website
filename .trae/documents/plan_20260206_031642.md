# 生图灵感模块开发计划

## 1. 需求分析文档 (Requirements Document)

### 1.1 项目概述
生图灵感模块是一个社区化的图片展示平台，旨在促进用户间的创意交流。用户可以将自己生成的 AI 图片分享到灵感社区，供他人欣赏或“做同款”（复制提示词和配置）。

### 1.2 用户角色与流程
*   **创作者 (Creator)**:
    *   **发布/分享**: 在“生成历史”中选择图片分享。
    *   **定价策略**: 可选择“免费分享”或“付费分享”（设定价格，如 1 积分）。
    *   **收益**: 其他用户付费使用同款时，创作者获得积分收益。
*   **浏览者 (Viewer)**:
    *   **浏览**: 以瀑布流/网格形式浏览最新或热门图片。
    *   **查看详情**: 点击图片查看大图、作者、生成时间及提示词（未解锁则模糊）。
    *   **做同款 (Make Same Style)**:
        *   **免费/已解锁**: 点击按钮直接跳转至生图页面，自动填充相同的提示词、模型及参数配置。
        *   **付费/未解锁**: 点击按钮提示需支付积分 -> 确认支付 -> 扣除积分 -> 解锁并跳转至生图页面自动填充。

### 1.3 功能列表
| 模块 | 功能点 | 描述 |
| :--- | :--- | :--- |
| **发布** | 分享设置 | 支持输入分享价格（0为免费）。 |
| **展示** | 列表展示 | 支持“最新”、“热门”、“我的”三个维度筛选；瀑布流/网格布局。 |
| | 图片详情 | 点击图片弹出模态框（Modal），展示大图及详细信息。 |
| | 提示词保护 | 付费图片在未解锁前，提示词内容需模糊处理或隐藏。 |
| **交互** | 点赞 | 支持对图片进行点赞/取消点赞。 |
| | 做同款 | 核心功能。一键复制配置到生图页。需处理付费逻辑。 |

### 1.4 数据交互流程
1.  **分享**: 前端调用 `/gallery/share` -> 后端更新 `is_public` 及 `price`。
2.  **浏览**: 前端调用 `/gallery/list` -> 后端返回图片列表（含 `is_unlocked` 状态）。
3.  **解锁**: 前端调用 `/gallery/unlock` -> 后端扣分、加分、记录解锁 -> 返回完整 `prompt`。
4.  **跳转**: 前端使用 `react-router` 携带 `state` 跳转至 `/` -> 首页 `GeneratePanel` 读取 `state` 并回填。

---

## 2. 开发实施计划 (Implementation Plan)

### 2.1 前端开发 (Frontend)
*   **组件改造 (`Gallery.tsx`)**:
    *   **新增详情弹窗 (Modal)**: 点击列表项时打开，全屏/半屏展示大图。
    *   **集成“做同款”逻辑**:
        *   实现 `handleMakeSameStyle` 函数。
        *   集成支付确认弹窗。
        *   支付成功后获取返回的 `prompt` 并跳转。
*   **生图页适配 (`Home.tsx` / `GeneratePanel.tsx`)**:
    *   验证 `initialData` 回填逻辑是否支持所有必要参数（提示词、模型、宽高比等）。(目前 `Home.tsx` 已有 `initialData` 逻辑，需确认其覆盖度)。

### 2.2 后端开发 (Backend)
*   **API 验证**: 确认 `/gallery/unlock` 接口返回的数据包含 `prompt` 且逻辑正确（已验证，目前返回 `{ success: true, prompt: ... }`）。
*   **无需新增 API**: 现有 API 已满足需求。

### 2.3 测试验证
*   **流程测试**:
    1.  用户 A 分享一张付费图片（价格 1）。
    2.  用户 B（积分充足）在画廊点击该图片 -> 点击“做同款” -> 提示支付 -> 确认 -> 跳转生图页 -> 参数自动填充。
    3.  用户 B（积分不足）点击“做同款” -> 提示充值。
    4.  用户 B 再次查看该图片 -> 显示已解锁 -> 点击“做同款”直接跳转。

## 3. 任务清单 (Todo List)
1.  [前端] 修改 `Gallery.tsx`，增加 `ImageDetailModal` 组件。
2.  [前端] 在 `Gallery.tsx` 中实现“做同款”的支付与跳转逻辑。
3.  [前端] 优化画廊 UI，增加“去做同款”显性按钮。
