I will fix the "no image" error when using ZX2 API provider by improving the error handling and result parsing logic.

### Problem Analysis
The error "no image" likely occurs because the code expects the image URL to be returned in a specific format from the ZX2 API check endpoint (`/api/result` or `/v1/tasks/{id}`), but the actual response might be different or the task might still be processing when the check is performed.

Looking at `generation.ts`, specifically the `callNanoBananaAPI` function and the `/check/:id` route:
1.  **Creation**: When creating a task with `providerType === 'zx2-async'`, it calls `${zx2BaseUrl}/api/generate`. It expects `data.code === 0` and returns `taskId`.
2.  **Checking**: In `/check/:id`, it calls `${zx2BaseUrl}/api/result`.
    *   It checks if `data.code !== 0`.
    *   If successful, it looks for `data.url`, `data.data.url`, `data.data.image_url`, or `data.data.images[0]`.
    *   If none of these are found, it returns `{ status: 'pending', progress: 50 }` (assuming it's still processing).

However, the user reports an explicit error message "no image". This string "no image" doesn't appear in the provided code snippet directly as an error message thrown by the system (except maybe implicitly).
Wait, I see `if (status === 'failed')` logic in the generic check loop, but for ZX2 specific logic (lines 502-560 in original file, likely shifted in current file), if it fails to find an image URL, it defaults to pending.

Let's look at where "no image" could come from.
In `callNanoBananaAPI` (ZX2 async part):
*   If `data.code !== 0`, it throws `API错误: ...`.
*   It returns `{ images: [], taskId, status: 'pending' }`.

In `/check/:id`:
*   If `imgUrl` is found, it returns success.
*   If NOT found, it returns pending.

**Hypothesis**: The error "no image" might be coming from the **Frontend** or a specific part of the backend I missed.
Let's re-examine `worker/src/routes/generation.ts`.
Wait, I don't see "no image" string in the search result.
However, if the API returns success (`code: 0`) but the image field is empty or null, the current logic returns `pending`.
If the user sees "生成失败，请重启 错误消息：no image", this format "生成失败... 错误消息：..." looks like it's constructed by the Frontend or the Backend's error handler.

If the backend throws an error, the frontend might display it.
Let's look at `generation.ts` line 287: `if (!apiResponse.images || apiResponse.images.length === 0) { throw new Error('API返回的图片列表为空') }`. This matches "no image" semantically but the text is different.

**Correction**: The user said "错误消息：no image". This might be the raw error message from the upstream API, or a specific string in the code.
If `data.msg` from ZX2 is "no image", then `return { status: 'failed', error: data.msg ... }` would pass it through.

**Plan**:
1.  **Enhance Logging**: Add more detailed logging in `/check/:id` for the ZX2 path to see exactly what the API returns.
2.  **Relax Success Check**: The current check `if (imgUrl)` might be too strict. I should inspect the full `data` object.
3.  **Handle "No Image" explicitly**: If the API returns `code: 0` but no image, it might be a failure disguised as success, or a specific state.
4.  **Fix potential bug**: The current code returns `pending` if no URL is found. If the task is actually done (e.g. `data.data.status === 'success'`) but we fail to parse the URL, we should probably error out or try harder to find the URL.

I will modify `worker/src/routes/generation.ts` to:
1.  Log the full response from `${zx2BaseUrl}/api/result`.
2.  Expand the fields checked for image URLs (e.g. `data.data` itself if it's a string).
3.  Add logic to handle cases where `status` says success but URL is missing.

I will also modify the `callNanoBananaAPI` function if necessary, but the issue seems to be in the checking phase (since it's an async task).

**Specific Changes**:
In `generationRoutes.get('/check/:id', ...)`:
Inside the `isZx2Async` block:
*   Log `data`.
*   Check more fields for the image URL.
*   If `data.data.status === 'failed'`, return failed.

Wait, looking at the code provided in the search result (lines 526+ in the previous context, now likely around 600+):
```typescript
                    const data: any = await res.json()
                    // ...
                    if (data.code !== 0) {
                        // ...
                        return { status: 'failed', error: data.msg || 'Unknown error' }
                    }
                    
                    // 成功
                    // 修正：ZX2 成功时直接在根对象返回 url，或者在 data.url
                    const imgUrl = data.url || data.data?.url || data.data?.image_url || data.data?.images?.[0]
```

I will add a fallback: check if `data.data` is a string and looks like a URL.
And I'll add logging to debug this "no image" state.

**Update**: The user says "错误消息：no image". If the API returns `{ code: 1, msg: "no image" }`, the current code returns `{ status: 'failed', error: "no image" }`. This explains the user's error message.
If the API itself fails with "no image", it might be because the task ID is invalid, or the image expired, or **the generation failed on their side**.
But if it's a generation failure, we should handle it gracefully.

However, if the user implies that *we* are generating this error, I need to be sure.
Actually, if the user sees "生成失败", it means the status became `failed`.
If the upstream API says "no image", we can't do much other than report it.
BUT, maybe we are sending wrong parameters?
The user says "ZX2类型".
In `callNanoBananaAPI`:
```typescript
    const requestBody: any = {
      model: 'nano-banana-pro', // 固定值
      prompt: params.prompt,
      aspectRatio: aspectRatio,
      imageSize: imageSize,
      urls: []
    }
```
Maybe `model` shouldn't be hardcoded? Or `urls` is empty?
The previous fix ensured `urls` is filled.

Let's assume the "no image" error comes from the ZX2 API check response.
If so, I will add a retry mechanism or better error parsing.
But more likely, I need to debug *why* it fails.
I will add logs first.

Wait, I cannot just "add logs" and ask the user to check. I should try to fix it based on common patterns.
Common issue with ZX2/NewAPI: The `check` endpoint might return 404 or error if checked too soon, or the format is slightly different.
I will add a `try-catch` block around the parsing and log the response.

**Revised Plan**:
1.  Modify `worker/src/routes/generation.ts`.
2.  In the `check` route (ZX2 section):
    *   Add `console.log` for the check response.
    *   Expand URL detection: `data.data` (string), `data.data.oss_url`.
    *   Handle the case where `data.code === 1` and `msg === 'no image'` -> maybe treat as pending if it's too soon? Or is it a definitive failure?
    *   "no image" usually sounds like "not found".
3.  Deploy.

Actually, if the API returns "no image", it likely means the generation failed or the image was deleted.
But if it happens *immediately* after generation, it's suspicious.
Maybe the `taskId` is wrong?
In `callNanoBananaAPI`, we get `taskId = data.data?.id`.
In `check`, we use that ID.

Let's just improve the logic to be more robust.
I will verify the `processAndUploadImages` isn't causing issues (it shouldn't affect the *check* status unless it throws).

**One more thing**: The user provided `zx2.52youxi.cc`. I can try to search for docs or known issues with this provider, but I don't have internet access to arbitrary sites (only via tool).
I will assume standard NewAPI/OneAPI behavior but with quirks.

**Action**:
1.  Edit `worker/src/routes/generation.ts`.
2.  Update the ZX2 check logic to log the response (via `logSystem` to DB so I can see it if I had access, or for the user to see in logs).
3.  Add more candidate fields for `imgUrl`.
4.  If `data.code !== 0` and msg is "no image", I will temporarily treat it as `pending` (retrying) for a few times? No, that might loop forever.
5.  Actually, looking at previous `callNanoBananaAPI`, we send `urls`.
    If the user doesn't provide a reference image, `urls` is `[]`.
    Does ZX2 require `urls` to be present?
    The code: `requestBody.urls = resolvedUrls`. If empty, it's `[]`.
    Maybe that's fine for text-to-image.

**Focus**: Fix the "no image" error handling.
I will update the code to handle `data.code != 0` more gracefully, and check more fields.
And I will add a special handling: if `msg` is "no image", maybe try to extract a URL anyway if present? Unlikely.

Let's refine the `check` logic.
```typescript
                    if (data.code !== 0) {
                        // ...
                        // If msg is "no image", it might be a temporary error?
                        // Let's log it.
                    }
```

I will implement a comprehensive check logic update.
