# 迁移 R2 存储至亚太地区 (APAC) 计划

为了解决图片加载慢的问题，我们将把 R2 存储桶从北美 (WNAM) 迁移到亚太地区 (APAC)，并配置双存储桶策略以确保旧图片依然可访问。

## 1. 创建新的亚太区存储桶
- 创建名为 `ai-image-uploads-apac` 的新 R2 存储桶。
- 指定区域位置提示 (Location Hint) 为 `apac` (亚太地区)，这将显著降低中国大陆及周边用户的访问延迟。

## 2. 配置 Worker 双桶绑定
修改 `wrangler.toml` 配置文件：
- **主要存储 (`IMAGES`)**: 指向新的 `ai-image-uploads-apac` 桶。新生成的图片将自动存入此处。
- **备用存储 (`IMAGES_OLD`)**: 指向原本的 `ai-image-uploads` 桶。

## 3. 升级图片服务逻辑
修改 `worker/src/routes/images.ts`：
- 实现智能回退逻辑：优先在主桶 (APAC) 查找图片；如果未找到，自动去备用桶 (WNAM) 查找。
- 这样既能让新图片享受高速访问，又能保证历史图片不丢失。

## 4. 优化缓存策略
- 确认并维持 `Cache-Control: public, max-age=31536000` 响应头，确保 Cloudflare 边缘节点能最大程度地缓存图片，进一步提升二次加载速度。

此方案无需迁移旧数据，平滑过渡，立即生效。